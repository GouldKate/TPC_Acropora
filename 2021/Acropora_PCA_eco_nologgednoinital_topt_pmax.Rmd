---
title: "Coral Holobiont Physiology under ramping temperature exposure"
output: 
  html_document:
    theme: simplex
    toc: yes
    toc_float: yes
  pdf_document:
    toc: yes
editor_options: 
  chunk_output_type: console
---

<style>
  h2{color: teal !important}
  h1{color: navy !important}
  body{background-color: gray95 !important}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
options(warn = -1)
```

```{r packages, include=FALSE}
setwd("C:/Github/TPC_Acropora")
#library("devtools")
#install_github("vqv/ggbiplot") # need this to download ggbiplot if not already installed
## Packages to load
library(devtools)
#install_github("vqv/ggbiplot")
#library(ggbiplot)
#require(devtools)
library(usethis)
#library(install_version)
library(magrittr)
#install_version("Magritter", version = "	2.0.1", repos = "http://cran.us.r-project.org")
library(knitr)
library(readr)
library(ggplot2)
library(dplyr)
#library(ggbiplot)
library(tidyr)
#library(openxlsx)
library(plotly)
library(tidyverse)
library(vegan)
library(shiny)
library(Rmisc)
library(cowplot)
library(ggfortify)
library(kableExtra)
library(readr)
#library(lmerTest)
library(vroom)
library(ggpubr)
library(magick)
library(Hmisc)
library(corrplot)
library(grid)
library(gridGraphics)
library(performance)
library(MASS)
library(r2symbols)
library(corrgram)
```

```{r set formatting and labels, include=FALSE}
## Set some standards and units
# dodge width
dodge=position_dodge(width=0.3)
dodge2=position_dodge(width = 0.6)
jitter=position_jitter(width=0.1)
# set figure theme
theme_set(theme_classic())
# set parameter labels
Plab<-expression(paste("log ", mu,"mol cm"^{-2}, "hr"^{-1}))
Tlab<-"Temperature (Â°C)"
plab<-expression(paste("Total protein ( "*mu,"g cm"^-2,")"))
dlab<-expression(paste("Cell density (10"^5,"cells cm"^-2,")"))
glab<-expression(paste("Growth Rate (%)"))
clab<-expression(paste("Chlorophyll a ( "*mu,"g cm"^-2,")"))
# set the current date
date <- Sys.Date() 
```

```{r original dataframe adjustment, include=FALSE}
df <- read_csv("C:/Github/TPC_Acropora/R_output_Data_Frames/EcophysLOGGEDdata.csv")
# read in full dataframe
# remove unnecessary column
df$X1 <- NULL
# set columns as factors
df$cat <- as.factor(df$cat)
df$genotype <- as.factor(df$genotype)
df$coral_id <- as.factor(df$coral_id)
df$treatment <- as.factor(df$treatment) 
# rename a couple columns
names(df)[15]<-"Chlo"
names(df)[19]<-"Growth"
names(df)[5]<-"Pro"
names(df)[23]<-"Zoox" 

# select columns of interest only
df2 <- df[,c(1:3,5,15, 19,22, 23)] 

#data.table::setnames(df2, old = c('protein_3d_ug_cm2','chl_ug_cm2', 'percent_growth', 'totzoox'), new = c('pro','chlo','growth', 'zoox')) #rename for plotting

df2 <- gather(df2, param, value, 'Pro','Chlo','Growth', 'Zoox') # make column of parameter and value

```

```{r bootstrap model setup}
## Performing the parametric bootstrapping of the model:
bootnum = 1500 # set number of iterations (we used 2000) between 999 and 9999
seed = 7 # seed to make results replicatable (our seed was 3)
set.seed(7)
```


```{r}
df_s <- df[,c(1:3,5,15, 19,22, 23)] 

## Function to remove rows with any missing values
completeFun <- function(data, desiredCols) {
  completeVec <- complete.cases(data[, desiredCols])
  return(data[completeVec, ])
}



df_s <- completeFun(df_s, "Chlo")
df_s <- completeFun(df_s, "Growth")
df_s <- completeFun(df_s, "Pro")
df_s <- completeFun(df_s, "Zoox")
df_s_l <- gather(df_s, param, value, 4:6,8)

## specific treatments dataframes
C_df <- subset(df_s, treatment == "Tc") # c
S_df <- subset(df_s, treatment == "T1") # s
F_df <- subset(df_s, treatment == "T2") # p
I_df <- subset(df_s, treatment == "T3") # a

## specific genotypes dataframes
K2_df <- subset(df_s, genotype == "K2") # s
M5_df <- subset(df_s, genotype == "M5") # s
M6_df <- subset(df_s, genotype == "M6") # p

```

## Principal component analyses Ecophys parameters only {.tabset}

#### *Methods:*
Principal component analysis (PCA) (function *prcomp*) of scaled and centered physiological parameters (host protein, algal symbiont chlorophyll a, algal symbiont cell density, percent growth were employed to assess the relationship between physiological parameters treatment conditions amd genotype for each coral. Main effects (treatment (Sprinkler- feeding & interactive), genotype) were evaluated with PERMANOVA using the *adonis2* function (*vegan* package; version `r packageVersion("vegan")` (Oksanen et al., 2020)).


<br/>

### interactive treatment and genotype
```{r}
# set up the dataframe
cat_pca_df <- df_s[,c(4:6,8)]

# run the adonis
cat_pca_mod <- adonis2(cat_pca_df ~ treatment*genotype, data = df_s, method = 'eu', permutations = bootnum)
cat_pca_mod # view  adonis output
# extract pvalues
cat_pval <- cat_pca_mod["Pr(>F)"]
# perform principal component analysis (PCA)
cat_pca <- prcomp(cat_pca_df, center = TRUE, scale= TRUE)
```


```{r interaction (treatment*genotype) PCA plot}
# create labels for p values calculated above
g_cat_pval <-substitute(italic(P[genotype])==p, list(p = format(cat_pval[2,1], digits = 1)))
t_cat_pval <-substitute(italic(P[treatment])==p, list(p = format(cat_pval[1,1], digits = 1)))
I_cat_pval <-substitute(italic(P[geno:treat])==p, list(p = format(cat_pval[3,1], digits = 2)))

# genotype across Treatment 1
# Treatment
Interg_cat_pca <- autoplot(cat_pca, data = df_s, 
         colour = "genotype",
         shape = "genotype",
         fill = "genotype",               
         frame = TRUE, 
         frame.type = "norm",
         frame.level= 0.95,
         frame.alpha = 0.0,
         loadings = TRUE, 
         loadings.colour = "black", 
         loadings.label = TRUE, 
         loadings.label.colour = "black",         
         loadings.label.size = 4, 
         loadings.label.hjust = 5, 
         loadings.label.vjust = 0.5,
         loadings.label.repel = TRUE) +
          scale_fill_manual(values = c('red','green4', 'blue'))+
    #scale_shape_manual("treatment", labels = c("Sprinkler", "Feeding", "Interactive", "Control"), values = c("T1","T2","T3","Tc")) +
    #guides(color = guide_legend(keyheight = 0.3, nrow = 6, byrow = TRUE, override.aes = list(linetype = c(0, 0)))) +
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(),strip.background = element_blank(), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.title = element_blank(), legend.background = element_rect(fill = "transparent", colour = NA)) +
  annotate("text", x = 0.0, y = -.75, label = deparse(g_cat_pval), parse = TRUE, size = 3)+
  ggtitle(expression(paste(bold("A)   "), "Genotype")))


Interg_cat_pca
ggsave("Interg_cat_pca.pdf")

Intert_cat_pca <- autoplot(cat_pca, data = df_s, 
         colour = "treatment",
         shape = "treatment",
         fill = "treatment",               
         frame = TRUE, 
         frame.type = "norm",
         frame.level= 0.95,
         frame.alpha = 0.0,
         loadings = TRUE, 
         loadings.colour = "black", 
         loadings.label = TRUE, 
         loadings.label.colour = "black",         
         loadings.label.size = 4, 
         loadings.label.hjust = 5, 
         loadings.label.vjust = 0.5,
         loadings.label.repel = TRUE) +
         scale_fill_manual(values = c('#66CCFF','#FFFF00', '#FF00CC', '#66FF33'))+
    #scale_shape_manual("treatment", labels = c("Sprinkler", "Feeding", "Interactive", "Control"), values = c("T1","T2","T3","Tc")) +
    #guides(color = guide_legend(keyheight = 0.3, nrow = 6, byrow = TRUE, override.aes = list(linetype = c(0, 0)))) +
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(),strip.background = element_blank(), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.title = element_blank(), legend.background = element_rect(fill = "transparent", colour = NA)) +
  annotate("text", x = 0.0, y = -.75, label = deparse(t_cat_pval), parse = TRUE, size = 3)+
  ggtitle(expression(paste(bold("B)   "), "Treatment")))


Intert_cat_pca
ggsave("Intert_cat_pca.pdf")

```

### **Figure 1**

```{r}
inter_PCA <- ggarrange( Interg_cat_pca,Intert_cat_pca, ncol = 2, common.legend = FALSE, legend = "right")
inter_PCA
ggarrange(inter_PCA) 
ggsave("inter_PCA.pdf")

```

### Subset data frame to analyze the difference between genotypes across treatments

```{r}
## specific treatments dataframes
S_df <- subset(df_s, treatment == "T1") # s
F_df <- subset(df_s, treatment == "T2") # p
I_df <- subset(df_s, treatment == "T3") # a
C_df <- subset(df_s, treatment == "Tc") # c
```

### Sprinkler Treatment
```{r}
# set up the dataframe
S_df <- unique(S_df) # remove any duplicate rows
s_df_l <- gather(S_df, param, value, c(4:6,8))
spr_pca_df <- S_df[,c(4:6,8)]

# run the adonis
s_pca_mod <- adonis2(spr_pca_df ~ genotype, data = S_df, method = 'eu', permutations = bootnum)
s_pca_mod # view  adonis output
summary(s_pca_mod)
# extract pvalues
s_pval <- s_pca_mod["Pr(>F)"]
# perform principal component analysis (PCA)
s_pca <- prcomp(spr_pca_df, center = TRUE, scale= TRUE)
s_pca
```

```{r sprinkler (T1) PCA plot}

# create labels for p values calculated above
s_geno_pval <-substitute(italic(P[genotype])==p, list(p = format(s_pval[1,1], digits = 1)))
# genotype across Treatment 1
# Treatment sprinkler
T1_geno_pca <- autoplot(s_pca, data = S_df, 
         colour = "genotype",
         shape = "genotype",
         fill = "genotype",               
         frame = TRUE, 
         frame.type = "norm",
         frame.level= 0.95,
         frame.alpha = 0,
         loadings = TRUE, 
         loadings.colour = "black", 
         loadings.label = TRUE,
         loadings.label.colour = "black",         
         loadings.label.size = 5, 
         loadings.label.hjust = 2.5, 
         loadings.label.vjust = 1,
         loadings.label.repel = TRUE) +
        scale_fill_manual(values = c('red','green4', 'blue'))+
 # scale_shape_manual("treatment", labels = c("Sprinkler", "Feeding", "Interactive", "Control"), values = c("T1","T2","T3","Tc")) +
  #scale_colour_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
  #scale_fill_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
    guides(color = guide_legend(keyheight = 0.3, nrow = 4, byrow = TRUE)) +
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(),strip.background = element_blank(), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.title = element_blank(), legend.background = element_rect(fill = "transparent", colour = NA)) +
  annotate("text", x = 0.0, y = -1.8, label = deparse(s_geno_pval), parse = TRUE, size = 3)+  ggtitle(expression(paste(bold("A)   "), "Sprinkler")))


T1_geno_pca
ggsave("T1_geno_pca.pdf")

```

### Feeding Treatment

```{r}
# set up the dataframe
F_df <- unique(F_df) # remove any duplicate rows
f_df_l <- gather(F_df, param, value, c(4:6,8))
feed_pca_df <- F_df[,c(4:6,8)]

# run the adonis
f_pca_mod <- adonis2(feed_pca_df ~ genotype, data = F_df, method = 'eu', permutations = bootnum)
f_pca_mod # view  adonis output
# extract pvalues
f_pval <- f_pca_mod["Pr(>F)"]
# perform principal component analysis (PCA)
f_pca <- prcomp(feed_pca_df, center = TRUE, scale= TRUE)

```

```{r Feeding (T2) PCA plot}

# create labels for p values calculated above
f_geno_pval <-substitute(italic(P[genotype])==p, list(p = format(f_pval[1,1], digits = 1)))
# genotype across Treatment 2
# Treatment Feeding
T2_geno_pca <- autoplot(f_pca, data = F_df, 
         colour = "genotype",
         shape = "genotype",
         fill = "genotype",               
         frame = TRUE, 
         frame.type = "norm",
         frame.level= 0.95,
         frame.alpha = 0,
         loadings = TRUE, 
         loadings.colour = "black", 
         loadings.label = TRUE,
         loadings.label.colour = "black",         
         loadings.label.size = 5, 
         loadings.label.hjust = 1.5, 
         loadings.label.vjust = 1,
         loadings.label.repel = TRUE) +
        scale_fill_manual(values = c('red','green4', 'blue'))+
 # scale_shape_manual("treatment", labels = c("Sprinkler", "Feeding", "Interactive", "Control"), values = c("T1","T2","T3","Tc")) +
  #scale_colour_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
  #scale_fill_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
    guides(color = guide_legend(keyheight = 0.3, nrow = 4, byrow = TRUE)) +
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(),strip.background = element_blank(), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.title = element_blank(), legend.background = element_rect(fill = "transparent", colour = NA)) +
  annotate("text", x = 0.0, y = -2, label = deparse(f_geno_pval), parse = TRUE, size = 3)+  ggtitle(expression(paste(bold("B)   "), "Feeding")))


T2_geno_pca
ggsave("T2_geno_pca.pdf")

```

### Interactive Sprinkler:Feeding Treatment
```{r}
I_df 
# set up the dataframe
I_df <- unique(I_df) # remove any duplicate rows
i_df_l <- gather(I_df, param, value, c(4:6,8))
inte_pca_df <- I_df[,c(4:6,8)]

# run the adonis
i_pca_mod <- adonis2(inte_pca_df ~ genotype, data = I_df, method = 'eu', permutations = bootnum)
i_pca_mod # view  adonis output
# extract pvalues
i_pval <- i_pca_mod["Pr(>F)"]
# perform principal component analysis (PCA)
i_pca <- prcomp(inte_pca_df, center = TRUE, scale= TRUE)
```

```{r Interactive (T3) PCA plot}

# create labels for p values calculated above
i_geno_pval <-substitute(italic(P[genotype])==p, list(p = format(i_pval[1,1], digits = 1)))
# genotype across Treatment 2
# Treatment Feeding
T3_geno_pca <- autoplot(i_pca, data = I_df, 
         colour = "genotype",
         shape = "genotype",
         fill = "genotype",               
         frame = TRUE, 
         frame.type = "norm",
         frame.alpha = 0,   
         frame.level= 0.95,
         loadings = TRUE, 
         loadings.colour = "black", 
         loadings.label = TRUE,
         loadings.label.colour = "black",         
         loadings.label.size = 5, 
         loadings.label.hjust = 1.5, 
         loadings.label.vjust = 1,
         loadings.label.repel = TRUE) +
        scale_fill_manual(values = c('red','green4', 'blue'))+
 # scale_shape_manual("treatment", labels = c("Sprinkler", "Feeding", "Interactive", "Control"), values = c("T1","T2","T3","Tc")) +
  #scale_colour_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
  #scale_fill_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
    guides(color = guide_legend(keyheight = 0.3, nrow = 4, byrow = TRUE)) +
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(),strip.background = element_blank(), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.title = element_blank(), legend.background = element_rect(fill = "transparent", colour = NA)) +
  annotate("text", x = 0.0, y = -1.5, label = deparse(i_geno_pval), parse = TRUE, size = 3)+  ggtitle(expression(paste(bold("C)   "), "Interactive")))


T3_geno_pca
ggsave("T3_geno_pca.pdf")

```

### Control Treatment
```{r}
C_df 
# set up the dataframe
C_df <- unique(C_df) # remove any duplicate rows
c_df_l <- gather(C_df, param, value, c(4:6,8))
cont_pca_df <- C_df[,c(4:6,8)]

# run the adonis
c_pca_mod <- adonis2(cont_pca_df ~ genotype, data = C_df, method = 'eu', permutations = bootnum)
c_pca_mod # view  adonis output
# extract pvalues
c_pval <- i_pca_mod["Pr(>F)"]
# perform principal component analysis (PCA)
c_pca <- prcomp(cont_pca_df, center = TRUE, scale= TRUE)

```

```{r Control (Tc) PCA plot}

# create labels for p values calculated above
c_geno_pval <-substitute(italic(P[genotype])==p, list(p = format(c_pval[1,1], digits = 1)))
# genotype across Treatment 2
# Treatment Feeding
Tc_geno_pca <- autoplot(c_pca, data = C_df, 
         colour = "genotype",
         shape = "genotype",
         fill = "genotype",               
         frame = TRUE, 
         frame.type = "norm",  
         frame.level= 0.95,
         frame.alpha = 0,
         loadings = TRUE, 
         loadings.colour = "black", 
         loadings.label = TRUE,
         loadings.label.colour = "black",         
         loadings.label.size = 5, 
         loadings.label.hjust = 1.5, 
         loadings.label.vjust = 1,
         loadings.label.repel = TRUE) +
        scale_fill_manual(values = c('red','green4', 'blue'))+
 # scale_shape_manual("treatment", labels = c("Sprinkler", "Feeding", "Interactive", "Control"), values = c("T1","T2","T3","Tc")) +
  #scale_colour_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
  #scale_fill_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
    guides(color = guide_legend(keyheight = 0.3, nrow = 4, byrow = TRUE)) +
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(),strip.background = element_blank(), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.title = element_blank(), legend.background = element_rect(fill = "transparent", colour = NA)) +
  annotate("text", x = 0.0, y = -1.5, label = deparse(c_geno_pval), parse = TRUE, size = 3)+  ggtitle(expression(paste(bold("D)   "), "Control")))


Tc_geno_pca
ggsave("Tc_geno_pca.pdf")

```

### Subset data frame to analyze the difference across treatments in each genotype

```{r}
## specific genotypes dataframes
K2_df <- subset(df_s, genotype == "K2") # s
M5_df <- subset(df_s, genotype == "M5") # s
M6_df <- subset(df_s, genotype == "M6") # p
```

### K2 genotype

```{r}
K2_df 
# set up the dataframe
K2_df <- unique(K2_df) # remove any duplicate rows
K2_df_l <- gather(K2_df, param, value, c(4:6,8))
K2_pca_df <- K2_df[,c(4:6,8)]

# run the adonis
K2_pca_mod <- adonis2(K2_pca_df ~ treatment, data = K2_df, method = 'eu', permutations = bootnum)
K2_pca_mod # view  adonis output
# extract pvalues
K2_pval <- K2_pca_mod["Pr(>F)"]
# perform principal component analysis (PCA)
K2_pca <- prcomp(K2_pca_df, center = TRUE, scale= TRUE)
```

```{r K2 (treatments) PCA plot}

# create labels for p values calculated above
K2_treat_pval <-substitute(italic(P[genotype])==p, list(p = format(K2_pval[1,1], digits = 1)))
#K2 genotype and all treatments
K2_geno_pca <- autoplot(K2_pca, data = K2_df, 
         colour = "treatment",
         shape = "treatment",
         fill = "treatment",               
         frame = TRUE, 
         frame.type = "norm",     
         frame.level= 0.95,
         frame.alpha = 0,
         loadings = TRUE, 
         loadings.colour = "black", 
         loadings.label = TRUE,
         loadings.label.colour = "black",         
         loadings.label.size = 5, 
         loadings.label.hjust = 1.5, 
         loadings.label.vjust = 1,
         loadings.label.repel = TRUE) +
 scale_fill_manual(values = c('#66CCFF','#FFFF00', '#FF00CC', '#66FF33'))+
 # scale_shape_manual("treatment", labels = c("Sprinkler", "Feeding", "Interactive", "Control"), values = c("T1","T2","T3","Tc")) +
  #scale_colour_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
  #scale_fill_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
    guides(color = guide_legend(keyheight = 0.3, nrow = 4, byrow = TRUE)) +
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(),strip.background = element_blank(), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.title = element_blank(), legend.background = element_rect(fill = "transparent", colour = NA)) +
  annotate("text", x = 0.0, y = -1.8, label = deparse(K2_treat_pval), parse = TRUE, size = 3)+  ggtitle(expression(paste(bold("A)   "), "K2")))


K2_geno_pca
ggsave("K2_geno_pca.pdf")

```

### M5 genotype

```{r}
M5_df 
# set up the dataframe
M5_df <- unique(M5_df) # remove any duplicate rows
M5_df_l <- gather(M5_df, param, value, c(4:6,8))
M5_pca_df <- M5_df[,c(4:6,8)]

# run the adonis
M5_pca_mod <- adonis2(M5_pca_df ~ treatment, data = M5_df, method = 'eu', permutations = bootnum)
M5_pca_mod # view  adonis output
# extract pvalues
M5_pval <- M5_pca_mod["Pr(>F)"]
# perform principal component analysis (PCA)
M5_pca <- prcomp(M5_pca_df, center = TRUE, scale= TRUE)
```

```{r M5 (treatments) PCA plot}

# create labels for p values calculated above
M5_treat_pval <-substitute(italic(P[genotype])==p, list(p = format(M5_pval[1,1], digits = 1)))
#M5 genotype and all treatments
M5_geno_pca <- autoplot(M5_pca, data = M5_df, 
         colour = "treatment",
         shape = "treatment",
         fill = "treatment",               
         frame = TRUE, 
         frame.type = "norm",         
         frame.level= 0.95,
         frame.alpha = 0,
         loadings = TRUE, 
         loadings.colour = "black", 
         loadings.label = TRUE,
         loadings.label.colour = "black",         
         loadings.label.size = 5, 
         loadings.label.hjust = 3, 
         loadings.label.vjust = 0,
         loadings.label.repel = TRUE) +
 scale_fill_manual(values = c('#66CCFF','#FFFF00', '#FF00CC', '#66FF33'))+
 # scale_shape_manual("treatment", labels = c("Sprinkler", "Feeding", "Interactive", "Control"), values = c("T1","T2","T3","Tc")) +
  #scale_colour_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
  #scale_fill_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
    guides(color = guide_legend(keyheight = 0.3, nrow = 4, byrow = TRUE)) +
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(),strip.background = element_blank(), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.title = element_blank(), legend.background = element_rect(fill = "transparent", colour = NA)) +
  annotate("text", x = -0.5, y = -1.3, label = deparse(M5_treat_pval), parse = TRUE, size = 3)+  ggtitle(expression(paste(bold("B)   "), "M5")))


M5_geno_pca
ggsave("M5_geno_pca.pdf")

```

### M6 genotype

```{r}
M6_df 
# set up the dataframe
M6_df <- unique(M6_df) # remove any duplicate rows
M6_df_l <- gather(M6_df, param, value, c(4:6,8))
M6_pca_df <- M6_df[,c(4:6,8)]

# run the adonis
M6_pca_mod <- adonis2(M6_pca_df ~ treatment, data = M6_df, method = 'eu', permutations = bootnum)
M6_pca_mod # view  adonis output
# extract pvalues
M6_pval <- M6_pca_mod["Pr(>F)"]
# perform principal component analysis (PCA)
M6_pca <- prcomp(M6_pca_df, center = TRUE, scale= TRUE)
```

```{r M6 (treatments) PCA plot}

# create labels for p values calculated above
M6_treat_pval <-substitute(italic(P[genotype])==p, list(p = format(M6_pval[1,1], digits = 1)))
#M6 genotype and all treatments
M6_geno_pca <- autoplot(M6_pca, data = M6_df, 
         colour = "treatment",
         shape = "treatment",
         fill = "treatment",               
         frame = TRUE, 
         frame.type = "norm",  
         frame.level= 0.95,
         frame.alpha = 0,
         loadings = TRUE, 
         loadings.colour = "black", 
         loadings.label = TRUE,
         loadings.label.colour = "black",         
         loadings.label.size = 5, 
         loadings.label.hjust = 3, 
         loadings.label.vjust = 0,
         loadings.label.repel = TRUE) +
 scale_fill_manual(values = c('#66CCFF','#FFFF00', '#FF00CC', '#66FF33'))+
 # scale_shape_manual("treatment", labels = c("Sprinkler", "Feeding", "Interactive", "Control"), values = c("T1","T2","T3","Tc")) +
  #scale_colour_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
  #scale_fill_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
    guides(color = guide_legend(keyheight = 0.3, nrow = 4, byrow = TRUE)) +
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(),strip.background = element_blank(), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.title = element_blank(), legend.background = element_rect(fill = "transparent", colour = NA)) +
  annotate("text", x = 0.0, y = -1.6, label = deparse(M6_treat_pval), parse = TRUE, size = 3)+  ggtitle(expression(paste(bold("B)   "), "M6")))


M6_geno_pca
ggsave("M6_geno_pca.pdf")

```


### **Figure 2 & 3**

```{r PCA plot}
#Figure 2
geno_PCA <- ggarrange(T1_geno_pca,T2_geno_pca,T3_geno_pca,Tc_geno_pca, ncol = 4, common.legend = TRUE, legend = "right")
ggarrange(geno_PCA) 
ggsave("geno_PCA.pdf")
#Figure 3
treat_PCA <- ggarrange(K2_geno_pca, M5_geno_pca, M6_geno_pca, ncol = 3, common.legend = TRUE, legend = "right")
ggarrange(treat_PCA) 
ggsave("treat_PCA.pdf")
```

<br/>
<br/>

### **Results**


#### *Principal component analysis*
Each PCA represents the first two principal components with ellipses at 95% confidence for the set of 2D normally distributed data samples. This confidence ellipse defines the region that contains 95% of all samples that can be drawn from the underlying Gaussian distribution)

#### *Treatment and genotypic differences in coral holobiont physiology*

The first two PCs of the combined holobiont physiology explained approximately `round(sum(summary(cat_pca)[["importance"]][2,1] + summary(cat_pca)[["importance"]][2,2]) * 100, 0)`% of variance in responses the interactive effect of both treatment and genotype (**Figure 1**). The first component is correlated with zoox and pro. All physiology variables are in the negative direction. Suggesting that all 4 variables vary together when one decreases/or increases the others follow suite. PC2 is most correlated with Growth and as growth increases chlo varies with it, while pro and zoox will decrease as growth and chlor increase. Holobiont physiology was predominantly driven by treatment (p = ` format(cat_pval[1,1], digits = 1)` (**Figure 1A**) While genotype and the interaction of the terms (treatmentXgenotype) did not explain as much variation in physiological responses (p = ` format(cat_pval[2,1], digits = 1)`, (p = `format(cat_pval[3,1], digits = 1)` respectively (**Figure 1B**).  N= 48 coral fragments from 3 genotypes (12 total corals per treatment, 4 individuals from each genotype)

<br/>

#### *Genotypic differences in coral holobiont physiology in each treatment (N=4)*

Two principal components (PCs) explained approximately `round(sum(summary(s_pca)[["importance"]][2,1] + summary(s_pca)[["importance"]][2,2]) * 100, 0)`% of the variance in physiological responses in the *Sprinkler T1 treatment* holobiont response after 2 weeks of increasing temperature treatments (0.5C per day) from (27-34C) (**Figure 2A**). PC1 is driven primarily by zoox density and protein content with an inverse relationship driven by differences in algal symbiont physiology (chlorophyll a and zoox cell density being negatively correlated). PC2 was driven by overall growth. Genotype was significantly different in the T1 sprinkler treatment response (p = `r format(s_pval[1,1], digits = 1)`). (N= 12, 4 individuals from three genotypes)

In *Feeding T2 treatment* two principal components (PCs) explained approximately `round(sum(summary(f_pca)[["importance"]][2,1] + summary(f_pca)[["importance"]][2,2]) * 100, 0)`% of the variance in physiological responses. (**Figure 2B**). PC1 is driven primarily by a correlated relationship between Protein and growth. There was an inverse relationship of protein and growth to zoox density and PC2 is explained primarily by chlorohyll a. No significant difference was found between Genotypes (p = `format(f_pval[1,1], digits = 1)`). (N= 12, 4 individuals from three genotypes)

In the *Interactive, Sprinkler:Feeding T3 treatment* two principal components (PCs) explained approximately
`round(sum(summary(i_pca)[["importance"]][2,1] + summary(i_pca)[["importance"]][2,2]) * 100, 0)`% of the variance in physiological responses. (**Figure 2C**). PC1 is explained by a correlated relationship with chlorophyll and zooxanthellae densities respectively. PC2 is explained by growth and protein. No significant difference was found between Genotypes (p = `format(i_pval[1,1], digits = 1)`).(N= 12, 4 individuals from three genotypes)


In the *Control Tc treatment* two principal components (PCs) explained approximately
`round(sum(summary(c_pca)[["importance"]][2,1] + summary(c_pca)[["importance"]][2,2]) * 100, 0)`% of the variance in physiological responses between genotypes. (**Figure 2d**). PC1 is explained by a correlated relationship with zooxanthellae densities and proteins with Chlorophyll a content in addition. PC2 is explained by growth. No significant difference was found between Genotypes (p = `format(i_pval[1,1], digits = 1)`).(N= 12, 4 individuals from three genotypes)

<br/>

#### *Treatment differences in coral holobiont physiology for each genotype (N=3)*

In the *Genotype K2* two principal components (PCs) explained approximately
`round(sum(summary(K2_pca)[["importance"]][2,1] + summary(K2_pca)[["importance"]][2,2]) * 100, 0)`% of the variance in physiological responses across the 4 treatments. (**Figure 3A**) PC1 is explained by growth and zooxanthella density with an inverse relationship to protein content. PC2 is primarily explained by Chlorophyll a. No significant difference was found between Treatments (p = `format(K2_pval[1,1], digits = 1)`).(N= 16, 4 individuals in each treatment (4 treatments)

In the *Genotype M5* two principal components (PCs) explained approximately
`round(sum(summary(M5_pca)[["importance"]][2,1] + summary(M5_pca)[["importance"]][2,2]) * 100, 0)`% of the variance in physiological responses across the 4 treatments. (**Figure 3B**). PC1 is explained by a correlated relationship between Zooxanthellae density, Protein and Chlorophyll a content. PC2 is primarily explained by growth. Significant differences were found between Treatments (p = `format(M5_pval[1,1], digits = 1)`).(N= 16, 4 individuals in each treatment (4 treatments)

In the *Genotype M6* two principal components (PCs) explained approximately
`round(sum(summary(M6_pca)[["importance"]][2,1] + summary(M6_pca)[["importance"]][2,2]) * 100, 0)`% of the variance in physiological responses across the 4 treatments. (**Figure 3B**). PC1 is explained by a correlated relationship between Zooxanthellae density and Chlorophyll a content Protein content also contributes to both PC1 and PC2. However, PC2 is primarily explained by growth. Significant differences were found between Treatments (p = `format(M6_pval[1,1], digits = 1)`).Treatment 1 and the Control treatment being the most different(N= 16, 4 individuals in each treatment (4 treatments)

<br/>
<br/>


## Principal component analyses including Pmax and Topt parameters estimated with *rTPC* package; version `r packageVersion("rTPC")` and *nls.multstart* package; version `r packageVersion("nls.multstart")` *See Acropora_TPC_Parameter_StatAnalysis_Final_2_24_2021.Rmd* {.tabset}

#### *Methods:*
Principal component analysis (PCA) (function *prcomp*) of scaled and centered physiological parameters (host protein, algal symbiont chlorophyll a, algal symbiont cell density, percent growth, Gross photosynthesis Pmax (performance maximum) and Topt (Thermal Optimum) were employed to assess the relationship between physiological parameters treatment conditions amd genotype for each coral. Main effects (treatment (Sprinkler- feeding & interactive), genotype) were evaluated with PERMANOVA using the *adonis2* function (*vegan* package; version `r packageVersion("vegan")` (Oksanen et al., 2020)).

<br/>

<br/>

### Read in Performance metrics

```{r}

# Add performance metrics to PCAs for Pmax & Topt
parameters<-read.csv("C:/Github/TPC_Acropora/R_output_Data_Frames/TPCparametersFrag.csv")
#Change TC to Tc to match the df_S data frame
parameters$treatment == "TC" <-("Tc")
parameters$treatment <- gsub('TC', 'Tc', parameters$treatment)
head(parameters)
parametersGP<-parameters%>%
  filter(rate.type=="GP")
View(parametersGP)
parametersGP$X<-NULL
parametersGP <- parametersGP[,c(1:2, 12, 14:15)] 
head(parametersGP)
names(parametersGP)[4]<-"coral_id"
parametersGP$cat <- paste(parametersGP$treatment,parametersGP$genotype)
# set columns as factors
parametersGP$cat <- as.factor(parametersGP$cat)
parametersGP$genotype <- as.factor(parametersGP$genotype)
parametersGP$coral_id <- as.factor(parametersGP$coral_id)
parametersGP$treatment <- as.factor(parametersGP$treatment) 
# rename a couple columns
names(parametersGP)[1]<-"Pmax"
names(parametersGP)[2]<-"Topt"
#rename df_s to combine
df_sP<-df_s

PM_PCA<-left_join(parametersGP,df_sP, by= c("coral_id", "cat", "genotype", "treatment")) 
head(PM_PCA)   
PM_PCA$Pmax<-as.numeric(PM_PCA$Pmax)
PM_PCA$Topt<-as.numeric(PM_PCA$Topt)
PM_PCA$Zoox<-as.numeric(PM_PCA$Zoox)
PM_PCA$Growth<-as.numeric(PM_PCA$Growth)
PM_PCA$Chlo<-as.numeric(PM_PCA$Chlo)
PM_PCA$Pro<-as.numeric(PM_PCA$Pro)

```


### interactive treatment and genotype
```{r}
# set up the dataframe
cat_pca_dfp <- PM_PCA[,c(1,7:10)]

# run the adonis
cat_pca_modp <- adonis2(cat_pca_dfp ~ treatment*genotype, data = PM_PCA, method = 'eu', permutations = bootnum)
cat_pca_modp # view  adonis output
# extract pvalues
cat_pavalp <- cat_pca_modp["Pr(>F)"]
# perform principal component analysis (PCA)
cat_pcap <- prcomp(cat_pca_dfp, center = TRUE, scale= TRUE)
```


```{r interaction (treatment*genotype) PCA plot}
# create labels for p values calculated above
g_cat_pavalp <-substitute(italic(P[genotype])==p, list(p = format(cat_pavalp[2,1], digits = 1)))
t_cat_pavalp <-substitute(italic(P[treatment])==p, list(p = format(cat_pavalp[1,1], digits = 1)))
I_cat_pavalp <-substitute(italic(P[geno:treat])==p, list(p = format(cat_pavalp[3,1], digits = 2)))

# genotype across Treatment 1
# Treatment
Interg_cat_pcap <- autoplot(cat_pcap, data = PM_PCA, 
         colour = "genotype",
         shape = "genotype",
         fill = "genotype",               
         frame = TRUE, 
         frame.type = "norm",
         frame.level= 0.95,
         frame.alpha = 0.0,
         loadings = TRUE, 
         loadings.colour = "black", 
         loadings.label = TRUE, 
         loadings.label.colour = "black",         
         loadings.label.size = 4, 
         loadings.label.hjust = 5, 
         loadings.label.vjust = 0.5,
         loadings.label.repel = TRUE) +
          scale_fill_manual(values = c('red','green4', 'blue'))+
    #scale_shape_manual("treatment", labels = c("Sprinkler", "Feeding", "Interactive", "Control"), values = c("T1","T2","T3","Tc")) +
    #guides(color = guide_legend(keyheight = 0.3, nrow = 6, byrow = TRUE, override.aes = list(linetype = c(0, 0)))) +
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(),strip.background = element_blank(), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.title = element_blank(), legend.background = element_rect(fill = "transparent", colour = NA)) +
  annotate("text", x = 0.0, y = -.75, label = deparse(g_cat_pavalp), parse = TRUE, size = 3)+
  ggtitle(expression(paste(bold("A)   "), "Genotype")))


Interg_cat_pcap
ggsave("Interg_cat_pcap.pdf")

Intert_cat_pcap <- autoplot(cat_pcap, data = PM_PCA, 
         colour = "treatment",
         shape = "treatment",
         #fill = "treatment",               
         frame = TRUE, 
         frame.type = "norm",
         frame.level= 0.95,
         frame.alpha = 0.0,
         loadings = TRUE, 
         loadings.colour = "black", 
         loadings.label = TRUE, 
         loadings.label.colour = "black",         
         loadings.label.size = 4, 
         loadings.label.hjust = 5, 
         loadings.label.vjust = 0.5,
         loadings.label.repel = TRUE) +
         scale_color_manual(values = c('#66CCFF','#FFFF00', '#FF00CC', '#66FF33'))+
    #scale_shape_manual("treatment", labels = c("Sprinkler", "Feeding", "Interactive", "Control"), values = c("T1","T2","T3","Tc")) +
    #guides(color = guide_legend(keyheight = 0.3, nrow = 6, byrow = TRUE, override.aes = list(linetype = c(0, 0)))) +
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(),strip.background = element_blank(), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.title = element_blank(), legend.background = element_rect(fill = "transparent", colour = NA)) +
  annotate("text", x = 0.0, y = -.75, label = deparse(t_cat_pavalp), parse = TRUE, size = 3)+
  ggtitle(expression(paste(bold("B)   "), "Treatment")))


Intert_cat_pcap
ggsave("Intert_cat_pcap.pdf")


#interactive
Interi_cat_pcap <- autoplot(cat_pcap, data = PM_PCA, 
         colour = "treatment",
         shape = "genotype",
         #size=3,
         alpha=5,
         fill = "treatment",               
         frame = TRUE, 
         frame.type = "norm",
         frame.level= 0.95,
         frame.alpha = 0.0,
         loadings = TRUE, 
         loadings.colour = "black", 
         loadings.label = TRUE, 
         loadings.label.colour = "black",         
         loadings.label.size = 4, 
         loadings.label.hjust = 5, 
         loadings.label.vjust = 0.5,
         loadings.label.repel = TRUE) +
         scale_color_manual(values = c('#66CCFF','#FFFF00', '#FF00CC', '#66FF33'))+
    #scale_shape_manual("treatment", labels = c("Sprinkler", "Feeding", "Interactive", "Control"), values = c("T1","T2","T3","Tc")) +
    #guides(color = guide_legend(keyheight = 0.3, nrow = 6, byrow = TRUE, override.aes = list(linetype = c(0, 0)))) +
 # theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(),strip.background = element_blank(), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.title = element_blank(), legend.background = element_rect(fill = "transparent", colour = NA)) +
  annotate("text", x = 0.0, y = -.75, label = deparse(I_cat_pavalp), parse = TRUE, size = 3)+
  ggtitle(expression(paste(bold("D)   "), "Interactive")))



Interi_cat_pcap
ggsave("Interi_cat_pcap.pdf")

Interig_cat_pcap <- autoplot(cat_pcap, data = PM_PCA, 
         colour = "genotype",
         shape = "treatment",
         #size=3,
         alpha=5,
         fill = "genotype",               
         frame = TRUE, 
         frame.type = "norm",
         frame.level= 0.95,
         frame.alpha = 0.0,
         loadings = TRUE, 
         loadings.colour = "black", 
         loadings.label = TRUE, 
         loadings.label.colour = "black",         
         loadings.label.size = 4, 
         loadings.label.hjust = 5, 
         loadings.label.vjust = 0.5,
         loadings.label.repel = TRUE) +
         #scale_color_manual(values = c('#66CCFF','#FFFF00', '#FF00CC', '#66FF33'))+
    #scale_shape_manual("treatment", labels = c("Sprinkler", "Feeding", "Interactive", "Control"), values = c("T1","T2","T3","Tc")) +
    #guides(color = guide_legend(keyheight = 0.3, nrow = 6, byrow = TRUE, override.aes = list(linetype = c(0, 0)))) +
 # theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(),strip.background = element_blank(), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.title = element_blank(), legend.background = element_rect(fill = "transparent", colour = NA)) +
  annotate("text", x = 0.0, y = -.75, label = deparse(I_cat_pavalp), parse = TRUE, size = 3)+
  ggtitle(expression(paste(bold("C)   "), "Interactive")))



Interig_cat_pcap
ggsave("Interig_cat_pcap.pdf")

```

### **Figure 1**

```{r}
inter_pcap <- ggarrange( Interg_cat_pcap,Intert_cat_pcap,Interig_cat_pcap,Interi_cat_pcap,  common.legend = FALSE, legend = "right")
inter_pcap
ggarrange(inter_pcap) 
ggsave("interall_pcap.pdf")

```

### Subset data frame to analyze the difference between genotypes across treatments

```{r}
## specific treatments dataframes
S_dfp <- subset(PM_PCA, treatment == "T1") # s
F_dfp <- subset(PM_PCA, treatment == "T2") # p
I_dfp <- subset(PM_PCA, treatment == "T3") # a
C_dfp <- subset(PM_PCA, treatment == "Tc") # c
```

### Sprinkler Treatment
```{r}
# set up the dataframe
S_dfp <- unique(S_dfp) # remove any duplicate rows
s_dfp_l <- gather(S_dfp, param, value, c(1,7:10))
spr_pca_dfp <- S_dfp[,c(1,7:10)]

# run the adonis
s_pca_modp <- adonis2(spr_pca_dfp ~ genotype, data = S_dfp, method = 'eu', permutations = bootnum)
s_pca_modp # view  adonis output
summary(s_pca_modp)
# extract pvalues
s_pavalp <- s_pca_modp["Pr(>F)"]
# perform principal component analysis (PCA)
s_pcap <- prcomp(spr_pca_dfp, center = TRUE, scale= TRUE)
s_pcap
```

```{r sprinkler (T1) PCA plot}

# create labels for p values calculated above
s_geno_pavalp <-substitute(italic(P[genotype])==p, list(p = format(s_pavalp[1,1], digits = 1)))
# genotype across Treatment 1
# Treatment sprinkler
T1_geno_pcap <- autoplot(s_pcap, data = S_dfp, 
         colour = "genotype",
         shape = "genotype",
         fill = "genotype",               
         frame = TRUE, 
         frame.type = "norm",
         frame.level= 0.95,
         frame.alpha = 0,
         loadings = TRUE, 
         loadings.colour = "black", 
         loadings.label = TRUE,
         loadings.label.colour = "black",         
         loadings.label.size = 5, 
         loadings.label.hjust = 2.5, 
         loadings.label.vjust = 1,
         loadings.label.repel = TRUE) +
        scale_fill_manual(values = c('red','green4', 'blue'))+
 # scale_shape_manual("treatment", labels = c("Sprinkler", "Feeding", "Interactive", "Control"), values = c("T1","T2","T3","Tc")) +
  #scale_colour_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
  #scale_fill_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
    guides(color = guide_legend(keyheight = 0.3, nrow = 4, byrow = TRUE)) +
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(),strip.background = element_blank(), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.title = element_blank(), legend.background = element_rect(fill = "transparent", colour = NA)) +
  annotate("text", x = 0.0, y = -1.8, label = deparse(s_geno_pavalp), parse = TRUE, size = 3)+  ggtitle(expression(paste(bold("A)   "), "Sprinkler")))


T1_geno_pcap
ggsave("T1_geno_pcap.pdf")

```

### Feeding Treatment

```{r}
# set up the dataframe
F_dfp <- unique(F_dfp) # remove any duplicate rows
f_dfp_l <- gather(F_dfp, param, value, c(1,7:10))
feed_pca_dfp <- F_dfp[,c(1,7:10)]

# run the adonis
f_pca_modp <- adonis2(feed_pca_dfp ~ genotype, data = F_dfp, method = 'eu', permutations = bootnum)
f_pca_modp # view  adonis output
# extract pvalues
f_pavalp <- f_pca_modp["Pr(>F)"]
# perform principal component analysis (PCA)
f_pcap <- prcomp(feed_pca_dfp, center = TRUE, scale= TRUE)

```

```{r Feeding (T2) PCA plot}

# create labels for p values calculated above
f_geno_pavalp <-substitute(italic(P[genotype])==p, list(p = format(f_pavalp[1,1], digits = 1)))
# genotype across Treatment 2
# Treatment Feeding
T2_geno_pcap <- autoplot(f_pcap, data = F_dfp, 
         colour = "genotype",
         shape = "genotype",
         fill = "genotype",               
         frame = TRUE, 
         frame.type = "norm",
         frame.level= 0.95,
         frame.alpha = 0,
         loadings = TRUE, 
         loadings.colour = "black", 
         loadings.label = TRUE,
         loadings.label.colour = "black",         
         loadings.label.size = 5, 
         loadings.label.hjust = 1.5, 
         loadings.label.vjust = 1,
         loadings.label.repel = TRUE) +
        scale_fill_manual(values = c('red','green4', 'blue'))+
 # scale_shape_manual("treatment", labels = c("Sprinkler", "Feeding", "Interactive", "Control"), values = c("T1","T2","T3","Tc")) +
  #scale_colour_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
  #scale_fill_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
    guides(color = guide_legend(keyheight = 0.3, nrow = 4, byrow = TRUE)) +
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(),strip.background = element_blank(), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.title = element_blank(), legend.background = element_rect(fill = "transparent", colour = NA)) +
  annotate("text", x = 0.0, y = -2, label = deparse(f_geno_pavalp), parse = TRUE, size = 3)+  ggtitle(expression(paste(bold("B)   "), "Feeding")))


T2_geno_pcap
ggsave("T2_geno_pcap.pdf")

```

### Interactive Sprinkler:Feeding Treatment
```{r}
I_dfp 
# set up the dataframe
I_dfp <- unique(I_dfp) # remove any duplicate rows
i_dfp_l <- gather(I_dfp, param, value, c(1,7:10))
inte_pca_dfp <- I_dfp[,c(1,7:10)]

# run the adonis
i_pca_modp <- adonis2(inte_pca_dfp ~ genotype, data = I_dfp, method = 'eu', permutations = bootnum)
i_pca_modp # view  adonis output
# extract pvalues
i_pavalp <- i_pca_modp["Pr(>F)"]
# perform principal component analysis (PCA)
i_pcap <- prcomp(inte_pca_dfp, center = TRUE, scale= TRUE)
```

```{r Interactive (T3) PCA plot}

# create labels for p values calculated above
i_geno_pavalp <-substitute(italic(P[genotype])==p, list(p = format(i_pavalp[1,1], digits = 1)))
# genotype across Treatment 2
# Treatment Feeding
T3_geno_pcap <- autoplot(i_pcap, data = I_dfp, 
         colour = "genotype",
         shape = "genotype",
         fill = "genotype",               
         frame = TRUE, 
         frame.type = "norm",
         frame.alpha = 0,   
         frame.level= 0.95,
         loadings = TRUE, 
         loadings.colour = "black", 
         loadings.label = TRUE,
         loadings.label.colour = "black",         
         loadings.label.size = 5, 
         loadings.label.hjust = 1.5, 
         loadings.label.vjust = 1,
         loadings.label.repel = TRUE) +
        scale_fill_manual(values = c('red','green4', 'blue'))+
 # scale_shape_manual("treatment", labels = c("Sprinkler", "Feeding", "Interactive", "Control"), values = c("T1","T2","T3","Tc")) +
  #scale_colour_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
  #scale_fill_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
    guides(color = guide_legend(keyheight = 0.3, nrow = 4, byrow = TRUE)) +
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(),strip.background = element_blank(), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.title = element_blank(), legend.background = element_rect(fill = "transparent", colour = NA)) +
  annotate("text", x = 0.0, y = -1.5, label = deparse(i_geno_pavalp), parse = TRUE, size = 3)+  ggtitle(expression(paste(bold("C)   "), "Interactive")))


T3_geno_pcap
ggsave("T3_geno_pcap.pdf")

```

### Control Treatment
```{r}
C_dfp 
# set up the dataframe
C_dfp <- unique(C_dfp) # remove any duplicate rows
c_dfp_l <- gather(C_dfp, param, value, c(1,7:10))
cont_pca_dfp <- C_dfp[,c(1,7:10)]

# run the adonis
c_pca_modp <- adonis2(cont_pca_dfp ~ genotype, data = C_dfp, method = 'eu', permutations = bootnum)
c_pca_modp # view  adonis output
# extract pvalues
c_pavalp <- i_pca_modp["Pr(>F)"]
# perform principal component analysis (PCA)
c_pcap <- prcomp(cont_pca_dfp, center = TRUE, scale= TRUE)

```

```{r Control (Tc) PCA plot}

# create labels for p values calculated above
c_geno_pavalp <-substitute(italic(P[genotype])==p, list(p = format(c_pavalp[1,1], digits = 1)))
# genotype across Treatment 2
# Treatment Feeding
Tc_geno_pcap <- autoplot(c_pcap, data = C_dfp, 
         colour = "genotype",
         shape = "genotype",
         fill = "genotype",               
         frame = TRUE, 
         frame.type = "norm",  
         frame.level= 0.95,
         frame.alpha = 0,
         loadings = TRUE, 
         loadings.colour = "black", 
         loadings.label = TRUE,
         loadings.label.colour = "black",         
         loadings.label.size = 5, 
         loadings.label.hjust = 1.5, 
         loadings.label.vjust = 1,
         loadings.label.repel = TRUE) +
        scale_fill_manual(values = c('red','green4', 'blue'))+
 # scale_shape_manual("treatment", labels = c("Sprinkler", "Feeding", "Interactive", "Control"), values = c("T1","T2","T3","Tc")) +
  #scale_colour_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
  #scale_fill_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
    guides(color = guide_legend(keyheight = 0.3, nrow = 4, byrow = TRUE)) +
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(),strip.background = element_blank(), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.title = element_blank(), legend.background = element_rect(fill = "transparent", colour = NA)) +
  annotate("text", x = 0.0, y = -1.5, label = deparse(c_geno_pavalp), parse = TRUE, size = 3)+  ggtitle(expression(paste(bold("D)   "), "Control")))


Tc_geno_pcap
ggsave("Tc_geno_pcap.pdf")

```

### Subset data frame to analyze the difference across treatments in each genotype

```{r}
## specific genotypes dataframes
K2_dfp <- subset(PM_PCA, genotype == "K2") # s
M5_dfp <- subset(PM_PCA, genotype == "M5") # s
M6_dfp <- subset(PM_PCA, genotype == "M6") # p
```

### K2 genotype

```{r}
K2_dfp 
# set up the dataframe
K2_dfp <- unique(K2_dfp) # remove any duplicate rows
K2_dfp_l <- gather(K2_dfp, param, value, c(1,7:10))
K2_pca_dfp <- K2_dfp[,c(1,7:10)]

# run the adonis
K2_pca_modp <- adonis2(K2_pca_dfp ~ treatment, data = K2_dfp, method = 'eu', permutations = bootnum)
K2_pca_modp # view  adonis output
# extract pvalues
K2_pavalp <- K2_pca_modp["Pr(>F)"]
# perform principal component analysis (PCA)
K2_pcap <- prcomp(K2_pca_dfp, center = TRUE, scale= TRUE)
```

```{r K2 (treatments) pca plot}

# create labels for p values calculated above
K2_treat_pavalp <-substitute(italic(P[genotype])==p, list(p = format(K2_pavalp[1,1], digits = 1)))
#K2 genotype and all treatments
K2_geno_pcap <- autoplot(K2_pcap, data = K2_dfp, 
         colour = "treatment",
         shape = "treatment",
         fill = "treatment",               
         frame = TRUE, 
         frame.type = "norm",     
         frame.level= 0.95,
         frame.alpha = 0,
         loadings = TRUE, 
         loadings.colour = "black", 
         loadings.label = TRUE,
         loadings.label.colour = "black",         
         loadings.label.size = 5, 
         loadings.label.hjust = 1.5, 
         loadings.label.vjust = 1,
         loadings.label.repel = TRUE) +
         scale_color_manual(values = c('#66CCFF','#FFFF00', '#FF00CC', '#66FF33'))+
 # scale_shape_manual("treatment", labels = c("Sprinkler", "Feeding", "Interactive", "Control"), values = c("T1","T2","T3","Tc")) +
  #scale_colour_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
  #scale_fill_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
    guides(color = guide_legend(keyheight = 0.3, nrow = 4, byrow = TRUE)) +
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(),strip.background = element_blank(), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.title = element_blank(), legend.background = element_rect(fill = "transparent", colour = NA)) +
  annotate("text", x = 0.0, y = -1.8, label = deparse(K2_treat_pavalp), parse = TRUE, size = 3)+  ggtitle(expression(paste(bold("A)   "), "K2")))


K2_geno_pcap
ggsave("K2_geno_pcap.pdf")

```

### M5 genotype

```{r}
M5_dfp 
# set up the dataframe
M5_dfp <- unique(M5_dfp) # remove any duplicate rows
M5_dfp_l <- gather(M5_dfp, param, value, c(1,7:10))
M5_pca_dfp <- M5_dfp[,c(1,7:10)]

# run the adonis
M5_pca_modp <- adonis2(M5_pca_dfp ~ treatment, data = M5_dfp, method = 'eu', permutations = bootnum)
M5_pca_modp # view  adonis output
# extract pvalues
M5_pavalp <- M5_pca_modp["Pr(>F)"]
# perform principal component analysis (PCA)
M5_pcap <- prcomp(M5_pca_dfp, center = TRUE, scale= TRUE)
```

```{r M5 (treatments) PCA plot}

# create labels for p values calculated above
M5_treat_pavalp <-substitute(italic(P[genotype])==p, list(p = format(M5_pavalp[1,1], digits = 1)))
#M5 genotype and all treatments
M5_geno_pcap <- autoplot(M5_pcap, data = M5_dfp, 
         colour = "treatment",
         shape = "treatment",
         fill = "treatment",               
         frame = TRUE, 
         frame.type = "norm",         
         frame.level= 0.95,
         frame.alpha = 0,
         loadings = TRUE, 
         loadings.colour = "black", 
         loadings.label = TRUE,
         loadings.label.colour = "black",         
         loadings.label.size = 5, 
         loadings.label.hjust = 3, 
         loadings.label.vjust = 0,
         loadings.label.repel = TRUE) +
         scale_color_manual(values = c('#66CCFF','#FFFF00', '#FF00CC', '#66FF33'))+
 # scale_shape_manual("treatment", labels = c("Sprinkler", "Feeding", "Interactive", "Control"), values = c("T1","T2","T3","Tc")) +
  #scale_colour_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
  #scale_fill_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
    guides(color = guide_legend(keyheight = 0.3, nrow = 4, byrow = TRUE)) +
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(),strip.background = element_blank(), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.title = element_blank(), legend.background = element_rect(fill = "transparent", colour = NA)) +
  annotate("text", x = -0.5, y = -1.3, label = deparse(M5_treat_pavalp), parse = TRUE, size = 3)+  ggtitle(expression(paste(bold("B)   "), "M5")))


M5_geno_pcap
ggsave("M5_geno_pcap.pdf")

```

### M6 genotype

```{r}
M6_dfp 
# set up the dataframe
M6_dfp <- unique(M6_dfp) # remove any duplicate rows
M6_dfp_l <- gather(M6_dfp, param, value, c(1,7:10))
M6_pca_dfp <- M6_dfp[,c(1,7:10)]

# run the adonis
M6_pca_modp <- adonis2(M6_pca_dfp ~ treatment, data = M6_dfp, method = 'eu', permutations = bootnum)
M6_pca_modp # view  adonis output
# extract pvalues
M6_pavalp <- M6_pca_modp["Pr(>F)"]
# perform principal component analysis (PCA)
M6_pcap <- prcomp(M6_pca_dfp, center = TRUE, scale= TRUE)
```

```{r M6 (treatments) PCA plot}

# create labels for p values calculated above
M6_treat_pvalp <-substitute(italic(P[genotype])==p, list(p = format(M6_pavalp[1,1], digits = 1)))
#M6 genotype and all treatments
M6_geno_pcap <- autoplot(M6_pcap, data = M6_dfp, 
         colour = "treatment",
         shape = "treatment",
         fill = "treatment",               
         frame = TRUE, 
         frame.type = "norm",  
         frame.level= 0.95,
         frame.alpha = 0,
         loadings = TRUE, 
         loadings.colour = "black", 
         loadings.label = TRUE,
         loadings.label.colour = "black",         
         loadings.label.size = 5, 
         loadings.label.hjust = 3, 
         loadings.label.vjust = 0,
         loadings.label.repel = TRUE) +
         scale_color_manual(values = c('#66CCFF','#FFFF00', '#FF00CC', '#66FF33'))+
 # scale_shape_manual("treatment", labels = c("Sprinkler", "Feeding", "Interactive", "Control"), values = c("T1","T2","T3","Tc")) +
  #scale_colour_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
  #scale_fill_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
    guides(color = guide_legend(keyheight = 0.3, nrow = 4, byrow = TRUE)) +
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(),strip.background = element_blank(), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.title = element_blank(), legend.background = element_rect(fill = "transparent", colour = NA)) +
  annotate("text", x = 0.0, y = -1.6, label = deparse(M6_treat_pvalp), parse = TRUE, size = 3)+  ggtitle(expression(paste(bold("B)   "), "M6")))


M6_geno_pcap
ggsave("M6_geno_pcap.pdf")

```


### **Figure 2 & 3**

```{r PCA plot}
#Figure 2
geno_pcap <- ggarrange(T1_geno_pcap,T2_geno_pcap,T3_geno_pcap,Tc_geno_pcap, ncol = 4, common.legend = TRUE, legend = "right")
ggarrange(geno_pcap) 
ggsave("geno_pcap.pdf")
#Figure 3
treat_pcap <- ggarrange(K2_geno_pcap, M5_geno_pcap, M6_geno_pcap, ncol = 3, common.legend = TRUE, legend = "right")
ggarrange(treat_pcap) 
ggsave("treat_pcap.pdf")
```

<br/>
<br/>

### **Results**


#### *Principal component analysis*
Each PCA represents the first two principal components with ellipses at 95% confidence for the set of 2D normally distributed data samples. This confidence ellipse defines the region that contains 95% of all samples that can be drawn from the underlying Gaussian distribution)

#### *Treatment and genotypic differences in coral holobiont physiology with Pmax*

The first two PCs of the combined holobiont physiology explained approximately `round(sum(summary(cat_pcap)[["importance"]][2,1] + summary(cat_pcap)[["importance"]][2,2]) * 100, 0)`% of variance in responses the interactive effect of both treatment and genotype (**Figure 1**). The first component is explain by Pmax- Zoox and a correlation between protein and chlorophyll. All physiology variables are in the negative direction. Suggesting that all 4 variables vary together when one decreases/or increases the others follow suite. PC2 is most correlated with Growth and closely associated with zoox however, as growth and zoox increases chlo protein and pmax will decrease as growth and zoox increase. Holobiont physiology was predominantly driven by treatment (p = ` format(cat_pavalp[1,1], digits = 1)` (**Figure 1A**)  and Genotype `format(cat_pavalp[2,1], digits = 1)` while the interaction of the terms (treatmentXgenotype) did not explained a significant effect in physiological responses (p = `format(cat_pavalp[3,1], digits = 1)` respectively (**Figure 1B**).  N= 48 coral fragments from 3 genotypes (12 total corals per treatment, 4 individuals from each genotype)

<br/>

#### *Genotypic differences in coral holobiont physiology in each treatment (N=4)*

Two principal components (PCs) explained approximately `round(sum(summary(s_pcap)[["importance"]][2,1] + summary(s_pcap)[["importance"]][2,2]) * 100, 0)`% of the variance in physiological responses in the *Sprinkler T1 treatment* holobiont response after 2 weeks of increasing temperature treatments (0.5C per day) from (27-34C) (**Figure 2A**). PC1 is driven primarily by protein density, Pmax, and zoox density, with a correlated relationship between Pmax and protein. There is an inverse relationship between Zoox and chlorophyll a when one increases the other will decrease. PC2 was driven by overall growth and chlorophyll content, these two also displaying an inverse relationship. Genotype was significantly different in the T1 sprinkler treatment response (p = `r format(s_pavalp[1,1], digits = 1)`). (N= 12, 4 individuals from three genotypes)

In *Feeding T2 treatment* two principal components (PCs) explained approximately `round(sum(summary(f_pcap)[["importance"]][2,1] + summary(f_pcap)[["importance"]][2,2]) * 100, 0)`% of the variance in physiological responses. (**Figure 2B**). PC1 is driven primarily by Pmax and protein content where Pmax has an inverse relationship with Zoox dentsity. PC2 is explained primarily by growth and chlorophyll a content. No significant differences were found between Genotypes (p = `format(f_pavalp[1,1], digits = 1)`). (N= 12, 4 individuals from three genotypes)

In the *Interactive, Sprinkler:Feeding T3 treatment* two principal components (PCs) explained approximately
`round(sum(summary(i_pcap)[["importance"]][2,1] + summary(i_pcap)[["importance"]][2,2]) * 100, 0)`% of the variance in physiological responses. (**Figure 2C**). PC1 is explained by a correlated relationship with chlorophyll Pmax and zooxanthellae densities respectively. PC2 is explained by growth with an inverse relationship to protein. No significant difference was found between Genotypes (p = `format(i_pavalp[1,1], digits = 1)`).(N= 12, 4 individuals from three genotypes)


In the *Control Tc treatment* two principal components (PCs) explained approximately
`round(sum(summary(c_pcap)[["importance"]][2,1] + summary(c_pcap)[["importance"]][2,2]) * 100, 0)`% of the variance in physiological responses between genotypes. (**Figure 2d**). PC1 is explained by  Chlorohyll and growth with a correlated relationship between Chlorophyll and protein.
PC2 is explained by Pmax with an inverse relationship to Zooxanthellae densities. No significant difference was found between Genotypes (p = `format(c_pavalp[1,1], digits = 1)`).(N= 12, 4 individuals from three genotypes)

<br/>

#### *Treatment differences in coral holobiont physiology for each genotype (N=3)*

In the *Genotype K2* two principal components (PCs) explained approximately
`round(sum(summary(K2_pcap)[["importance"]][2,1] + summary(K2_pcap)[["importance"]][2,2]) * 100, 0)`% of the variance in physiological responses across the 4 treatments. (**Figure 3A**) PC1 is explained by Pmax and Protein, Pmax and CHlorophyll have a correlated relationship. PC2 is primarily explained by acorrelated relationship between growth and zooxanthellae density. No significant difference was found between Treatments (p = `format(K2_pavalp[1,1], digits = 1)`).(N= 16, 4 individuals in each treatment (4 treatments)

In the *Genotype M5* two principal components (PCs) explained approximately
`round(sum(summary(M5_pcap)[["importance"]][2,1] + summary(M5_pcap)[["importance"]][2,2]) * 100, 0)`% of the variance in physiological responses across the 4 treatments. (**Figure 3B**). PC1 is explained by Pmax zooxanthellae, with a correlated relationship between Zoox and chlorohyll a content. PC2 is primarily explained by protein and growth Significant differences were found between Treatments (p = `format(M5_pavalp[1,1], digits = 1)`).(N= 16, 4 individuals in each treatment (4 treatments)

In the *Genotype M6* two principal components (PCs) explained approximately
`round(sum(summary(M6_pcap)[["importance"]][2,1] + summary(M6_pcap)[["importance"]][2,2]) * 100, 0)`% of the variance in physiological responses across the 4 treatments. (**Figure 3B**). PC1 is explained by Pmax protein and chlorophylla that is correlated closely with Zooxanthella. PC2 is primarily explained by growth. Significant differences were found between Treatments (p = `format(M6_pavalp[1,1], digits = 1)`).Treatment 1 and the Control treatment being the most different(N= 16, 4 individuals in each treatment (4 treatments)

<br/>
<br/>

##########################################################################################


M6 ecophys parameters growth
```{r}
M6_dfp$Growth
mPGPsp<-lm(Growth~treatment,M6_dfp)
summary(mPGPsp)

mPGPsp2<-aov(Growth~treatment,M6_dfp)
summary(mPGPsp2)
anova(mPGPsp)
## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cookâs distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")


##Checking non logged transformed portein data
ggdensity(M6_dfp$Growth, 
          main = "Density plot of Growth",
          xlab = "Growth")
#SKEWED
ggqqplot(M6_dfp$Growth)
shapiro.test(M6_dfp$Growth)
bartlett.test(Growth~treatment, data=M6_dfp)
leveneTest(Growth~treatment, data=M6_dfp)
fligner.test(Growth~treatment, data=M6_dfp)


```

M6 ecophys parameters growth
parameteric comparisons

```{r}

M6_dfpsum<-M6_dfp %>% 
  group_by(treatment) %>%
  get_summary_stats(Growth, type = "common")

M6_dfpsumT<-kable(M6_dfpsum, digits = 4,
      caption = "Summary statistics for Growth GP values",
      col.names = c( "Genotype", "Parameter", "n", "Min", "Max", "Median", "IQR", "Mean","SD", "SE", "CI"),
      align = 'c') %>%
  kable_styling(bootstrap_options =
                  c("hover", "responsive", "striped"),
                full_width = F, position = "center")

M6_dfpsumT
# Proceed with ANOVA/lm post hoc Tukeys HSD


GrowthTmod<-lm(Growth~treatment,M6_dfp)
summary(GrowthTmod)

Growthtmod<-aov(Growth~treatment,M6_dfp)
TukeyHSD(Growthtmod)

GrowthtmodP<-ggplot(Growthtmod, aes(x=treatment, Growth, fill= treatment))+
  stat_boxplot(geom= "errorbar", width= 0.5, position = position_dodge(1))+
  geom_boxplot(position = position_dodge(1),outlier.shape=1)+
  theme_classic()+
  xlab('Treatment')+
  ylab("Growth (% increase in g)")+
  ggtitle("Growth")+
      stat_summary(fun=mean, geom="point", size=2)+ #line is median, and closed circle is mean
  stat_compare_means(label.y=.9, method = "anova")+
  scale_fill_manual(values = c('#66CCFF','#FFFF00', '#FF00CC', '#66FF33'))+
  scale_x_discrete(breaks=c("T1", "T2", "T3", "TC"),
        labels=c("Sprinkler", "Feeding", "Interactive","Control"))

GrowthtmodP
ggexport(GrowthtmodP, filename = "GrowthANOplottrea.pdf")

```

##########################################################################################

<br/>

## Correlation assessments {.tabset}

#### *Methods:*
Correlations (Correlation test is used to evaluate the association between two or more variables.) among all physiological parameters were assessed to determine the relationships between parameters within each genotype and treatment The Pearson correlation coefficient (R^2^) of each comparison was calculated using the rcorr package (version `r packageVersion("rcorr")` and the significance was calculated using the *cor.test* function. These relationships were then visualized through simple scatterplots.

<br/>


```{r}
S_df 
F_df 
I_df 
C_df 
K2_df
M5_df
M6_df
S_dfp 
F_dfp 
I_dfp 
C_dfp 
K2_dfp
M5_dfp
M6_dfp
```

Correlation matrix The function rcorr() [in Hmisc package] can be used to compute the significance levels for pearson and spearman correlations. It returns both the correlation coefficients and the p-value of the correlation for all possible pairs of columns in the data table.
```{r}
## create matrix for correlations for all
all_corr_df2 <-rcorr(as.matrix(PM_PCA[,c(7:10)]))
all_corr_df2
all_corr_df2$r
all_corr_df2$P
all_corr_df2$r[all_corr_df2$r < 0] <- 0
## create matrix for correlations by treatment
C_corr_df2 <- rcorr(as.matrix(C_df[, c(4:6,8)])) #
C_corr_df2 # correlation matrix
C_corr_df2$r  # R2 of all correlations
C_corr_df2$P  # P value of all correlations
C_corr_df2$r[C_corr_df2$r < 0] <- 0 # this just makes negative correlations 0 since none are significant (easier for plotting)

S_corr_df2 <- rcorr(as.matrix(S_df[, c(4:6,8)])) #
S_corr_df2 # correlation matrix
S_corr_df2$r  # R2 of all correlations
S_corr_df2$P  # P value of all correlations
S_corr_df2$r[S_corr_df2$r < 0] <- 0 # this just makes negative correlations 0 since none are significant (easier for plotting)

F_corr_df2 <- rcorr(as.matrix(F_df[, c(4:6,8)])) #
F_corr_df2 # correlation matrix
F_corr_df2$r  # R2 of all correlations
F_corr_df2$P  # P value of all correlations
F_corr_df2$r[F_corr_df2$r < 0] <- 0 # this just makes negative correlations 0 since none are significant (easier for plotting)

I_corr_df2 <- rcorr(as.matrix(I_df[, c(4:6,8)])) #
I_corr_df2 # correlation matrix
I_corr_df2$r  # R2 of all correlations
I_corr_df2$P  # P value of all correlations
I_corr_df2$r[I_corr_df2$r < 0] <- 0 # this just makes negative correlations 0 since none are significant (easier for plotting)


## create matrix for correlations by genotype
K2_corr_df2 <- rcorr(as.matrix(K2_df[, c(4:6,8)])) #
K2_corr_df2 # correlation matrix
K2_corr_df2$r  # R2 of all correlations
K2_corr_df2$P  # P value of all correlations
K2_corr_df2$r[K2_corr_df2$r < 0] <- 0 # this just makes negative correlations 0 since none are significant (easier for plotting)

M5_corr_df2 <- rcorr(as.matrix(M5_df[, c(4:6,8)])) #
M5_corr_df2 # correlation matrix
M5_corr_df2$r  # R2 of all correlations
M5_corr_df2$P  # P value of all correlations
M5_corr_df2$r[M5_corr_df2$r < 0] <- 0 # this just makes negative correlations 0 since none are significant (easier for plotting)

M6_corr_df2 <- rcorr(as.matrix(M6_df[, c(4:6,8)])) #
M6_corr_df2 # correlation matrix
M6_corr_df2$r  # R2 of all correlations
M6_corr_df2$P  # P value of all correlations
M6_corr_df2$r[M6_corr_df2$r < 0] <- 0 # this just makes negative correlations 0 since none are significant (easier for plotting)
```

With Pmax

```{r}
## create matrix for correlations for all
all_corrp_df2 <-rcorr(as.matrix(PM_PCA[,c(1,7:10)]))
all_corrp_df2
all_corrp_df2$r
all_corrp_df2$P
all_corrp_df2$r[all_corrp_df2$r < 0] <- 0
## create matrix for correlations by treatment
C_corrp_df2 <- rcorr(as.matrix(C_dfp[, c(1, 7:10)])) #
C_corrp_df2 # correlation matrix
C_corrp_df2$r  # R2 of all correlations
C_corrp_df2$P  # P value of all correlations
C_corrp_df2$r[C_corrp_df2$r < 0] <- 0 # this just makes negative correlations 0 since none are significant (easier for plotting)

S_corrp_df2 <- rcorr(as.matrix(S_dfp[, c(1, 7:10)])) #
S_corrp_df2 # correlation matrix
S_corrp_df2$r  # R2 of all correlations
S_corrp_df2$P  # P value of all correlations
S_corrp_df2$r[S_corrp_df2$r < 0] <- 0 # this just makes negative correlations 0 since none are significant (easier for plotting)

F_corrp_df2 <- rcorr(as.matrix(F_dfp[, c(1, 7:10)])) #
F_corrp_df2 # correlation matrix
F_corrp_df2$r  # R2 of all correlations
F_corrp_df2$P  # P value of all correlations
F_corrp_df2$r[F_corrp_df2$r < 0] <- 0 # this just makes negative correlations 0 since none are significant (easier for plotting)

I_corrp_df2 <- rcorr(as.matrix(I_dfp[, c(1, 7:10)])) #
I_corrp_df2 # correlation matrix
I_corrp_df2$r  # R2 of all correlations
I_corrp_df2$P  # P value of all correlations
I_corrp_df2$r[I_corrp_df2$r < 0] <- 0 # this just makes negative correlations 0 since none are significant (easier for plotting)

## create matrix for correlations by genotype
K2_corrp_df2 <- rcorr(as.matrix(K2_dfp[, c(1, 7:10)])) #
K2_corrp_df2 # correlation matrix
K2_corrp_df2$r  # R2 of all correlations
K2_corrp_df2$P  # P value of all correlations
K2_corrp_df2$r[K2_corrp_df2$r < 0] <- 0 # this just makes negative correlations 0 since none are significant (easier for plotting)

M5_corrp_df2 <- rcorr(as.matrix(M5_dfp[, c(1, 7:10)])) #
M5_corrp_df2 # correlation matrix
M5_corrp_df2$r  # R2 of all correlations
M5_corrp_df2$P  # P value of all correlations
M5_corrp_df2$r[M5_corrp_df2$r < 0] <- 0 # this just makes negative correlations 0 since none are significant (easier for plotting)

M6_corrp_df2 <- rcorr(as.matrix(M6_dfp[, c(1, 7:10)])) #
M6_corrp_df2 # correlation matrix
M6_corrp_df2$r  # R2 of all correlations
M6_corrp_df2$P  # P value of all correlations
M6_corrp_df2$r[M6_corrp_df2$r < 0] <- 0 # this just makes negative correlations 0 since none are significant (easier for plotting)
```

Treatments
```{r correlation matrix plot method 1, eval=FALSE, include=FALSE}
### This is the first method of a correlation plot. 
#All
pdf(file = "All_corrplot.pdf")

corrplot(cor(all_corr_df2$r), type="upper", order="hclust",  p.mat = all_corr_df2$P, sig.level =-1, insig = "p-value", method = "ellipse", tl.col = "black", tl.srt=45,mar=c(0,0,1,0))
grid.echo()

all_corr_plot <- grid.grab()

dev.off()
# Control
library(grDevices)
pdf(file = "TC_corrplot.pdf")

corrplot(cor(C_corr_df2$r), type="upper", order="hclust",  p.mat = C_corr_df2$P, sig.level =-1, insig = "p-value", method = "ellipse", tl.col = "black", tl.srt=45, title = "Control",mar=c(0,0,1,0))
grid.echo()

C_corr_plot <- grid.grab()

dev.off()

res <- cor.test(C_df$Zoox, C_df$Pro, 
                    method = "pearson")
res
# Zoox and protein are significantly correlated with a correlation coefficient of 0.857 and p-value of 0.0003585
 
res <- cor.test(C_df$Zoox, C_df$Chlo, 
                    method = "pearson")
res
# Zoox and CHlorophyll are significantly correlated with a correlation coefficient of 0.6026615 and p-value of 0.03807

res <- cor.test(C_df$Growth, C_df$Chlo, 
                    method = "pearson")
res
#Growth and CHlorophyll are significantly correlated with a correlation coefficient of 0.6210281 and p-value of  0.03115

# Sprinkler
pdf(file = "T1_corrplot.pdf")

corrplot(S_corr_df2$r, type="upper", order="hclust",  p.mat = S_corr_df2$P, sig.level = -1, insig = "p-value", method = "ellipse", tl.col = "black", tl.srt=45, title = "Sprinkler",mar=c(0,0,1,0))

grid.echo()
S_corr_plot <- grid.grab()
dev.off()
# Feeding
pdf(file = "T2_corrplot.pdf")

corrplot(F_corr_df2$r, type="upper", order="hclust", p.mat = F_corr_df2$P, sig.level = -1, insig = "p-value", method = "ellipse", tl.col = "black", tl.srt=45,title = "Feeding",mar=c(0,0,1,0))
grid.echo()
F_corr_plot <- grid.grab()
dev.off()
# Interactive
pdf(file = "T3_corrplot.pdf")

corrplot(I_corr_df2$r, type="upper", order="hclust", p.mat = I_corr_df2$P, sig.level = -1, insig = "p-value", method = "ellipse", tl.col = "black", tl.srt=45,title = "Interactive",mar=c(0,0,1,0))

grid.echo()
I_corr_plot <- grid.grab()
dev.off()
res <- cor.test(I_df$Zoox, I_df$Chlo, 
                    method = "pearson")
res
# Zoox and CHlorophyll are significantly correlated with a correlation coefficient of 0.6526393 and p-value of 0.03807


#grid.draw(P1)
plot_grid(C_corr_plot, S_corr_plot,F_corr_plot, I_corr_plot, ncol = 2)
```
Genotype
```{r}
# K2
pdf(file = "K2_corrplot.pdf")

corrplot(K2_corr_df2$r, type="upper", order="hclust", p.mat = K2_corr_df2$P, sig.level = -1, insig = "p-value", method = "ellipse", tl.col = "black", tl.srt=45, title = "K2",mar=c(0,0,1,0))
grid.echo()
K2_corr_plot <- grid.grab()
dev.off()
# M5
pdf(file = "M5_corrplot.pdf")

corrplot(M5_corr_df2$r, type="upper", order="hclust", p.mat = M5_corr_df2$P, sig.level = -1, insig = "p-value", method = "ellipse", tl.col = "black", tl.srt=45, title = "M5",mar=c(0,0,1,0))
grid.echo()
M5_corr_plot <- grid.grab()
dev.off()
res <- cor.test(M5_df$Zoox, M5_df$Pro, 
                    method = "pearson")
res
# Zoox and Protein are significantly correlated with a correlation coefficient of 0.8651897 and p-value of  1.508e-05

# M6
pdf(file = "M6_corrplot.pdf")

corrplot(M6_corr_df2$r, type="upper", order="hclust", p.mat = M6_corr_df2$P, sig.level = -1, insig = "p-value", method = "ellipse", tl.col = "black", tl.srt=45, title = "M6",mar=c(0,0,1,0))
grid.echo()
M6_corr_plot <- grid.grab()
dev.off()
#grid.draw(P1)
plot_grid(K2_corr_plot, M5_corr_plot, M6_corr_plot, ncol = 1, labels= "AUTO")
```


Treatments with Pmax
```{r correlation matrix plot method 1, eval=FALSE, include=FALSE}
### This is the first method of a correlation plot. 
pdf(file = "Allp_corrplot.pdf")

corrplot(cor(all_corrp_df2$r), type="upper", order="hclust",  p.mat = all_corrp_df2$P, sig.level =-1, insig = "p-value", method = "ellipse", tl.col = "black", tl.srt=45,mar=c(0,0,1,0))
grid.echo()

allp_corr_plot <- grid.grab()

dev.off()
# Control
pdf(file = "TC2_corrplot.pdf")

corrplot(cor(C_corrp_df2$r), type="upper", order="hclust", p.mat = C_corrp_df2$P, sig.level = -1, insig = "p-value", method = "ellipse", tl.col = "black", tl.srt=45, title = "Control",mar=c(0,0,1,0))
grid.echo()
C_corrp_plot <- grid.grab()
dev.off()
res <- cor.test(C_dfp$Chlo, C_dfp$Growth, 
                    method = "pearson")
res
# Chlrorphyll and growth are significantly correlated with a correlation coefficient of 0.8111125 and p-value of  0.002447
res <- cor.test(C_dfp$Chlo, C_dfp$Zoox, 
                    method = "pearson")
res
# Chlrorphyll and zooxanthellae are significantly correlated with a correlation coefficient of 0.6432538  and p-value of  0.03275

# Sprinkler
pdf(file = "T12_corrplot.pdf")

corrplot(S_corrp_df2$r, type="upper", order="hclust", p.mat = S_corrp_df2$P, sig.level = -1, insig = "p-value", method = "ellipse", tl.col = "black", tl.srt=45, title = "Sprinkler",mar=c(0,0,1,0))
grid.echo()
S_corrp_plot <- grid.grab()
dev.off()
# Feeding
pdf(file = "T22_corrplot.pdf")

corrplot(F_corrp_df2$r, type="upper", order="hclust", p.mat = F_corrp_df2$P, sig.level = -1, insig = "p-value", method = "ellipse", tl.col = "black", tl.srt=45, title = "Feeding",mar=c(0,0,1,0))
grid.echo()
F_corrp_plot <- grid.grab()
dev.off()
# Interactive
pdf(file = "T32_corrplot.pdf")

corrplot(I_corrp_df2$r, type="upper", order="hclust", p.mat = I_corrp_df2$P, sig.level = -1, insig = "p-value", method = "ellipse", tl.col = "black", tl.srt=45, title = "Interactive",mar=c(0,0,1,0))
grid.echo()
I_corrp_plot <- grid.grab()
dev.off()
res <- cor.test(I_dfp$Chlo, I_dfp$Pmax, 
                    method = "pearson")
res
res <- cor.test(I_dfp$Chlo, I_dfp$Zoox, 
                    method = "pearson")
res
res <- cor.test(I_dfp$Pmax, I_dfp$Zoox, 
                    method = "pearson")
res
#grid.draw(P1)
plot_grid(C_corrp_plot, S_corrp_plot,F_corrp_plot, I_corrp_plot, ncol = 2)
```
Genotype with Pmax
```{r}
# K2
pdf(file = "K22_corrplot.pdf")

corrplot(K2_corrp_df2$r, type="upper", order="hclust", p.mat = K2_corrp_df2$P, sig.level = -1, insig = "p-value", method = "ellipse", tl.col = "black", tl.srt=45, title = "K2",mar=c(0,0,1,0))
grid.echo()
K2_corrp_plot <- grid.grab()
dev.off()
# M5
pdf(file = "M52_corrplot.pdf")

corrplot(M5_corrp_df2$r, type="upper", order="hclust", p.mat = M5_corrp_df2$P, sig.level = -1, insig = "p-value", method = "ellipse", tl.col = "black", tl.srt=45, title = "M5",mar=c(0,0,1,0))
grid.echo()
M5_corrp_plot <- grid.grab()
dev.off()
# M6
pdf(file = "M62_corrplot.pdf")

corrplot(M6_corrp_df2$r, type="upper", order="hclust", p.mat = M6_corrp_df2$P, sig.level = -1, insig = "p-value", method = "ellipse", tl.col = "black", tl.srt=45, title = "M6",mar=c(0,0,1,0))
grid.echo()
M6_corrp_plot <- grid.grab()
dev.off()
#grid.draw(P1)
plot_grid(K2_corrp_plot, M5_corrp_plot, M6_corrp_plot, ncol = 1, labels= "AUTO")
```

### **Results**

#### *Correlations of physiological parameters*

Coral holobiont physiological parameters were generally positively correlated with one another within each of the three species. Correlations between *S. siderea* holobiont physiological parameters identified 15 significant relationships out of all 21 possible comparisons (**Figure 2A**). Of those significant correlations, six resulted in a Pearson's correlation coefficient (R^2^) equal to or greater than 0.5, with the strongest relationship identified between symbiont density and chlorophyll a (R^2^ = 0.72).   

All pairwise physiological parameters were significantly correlated with one another in *P. strigosa* and, of those, 15 correlations exhibit moderate (R^2^ > 0.50) positive relationships (**Figure 2B**). Notably, the two strongest correlations were host carbohydrate vs. host protein (R^2^ = 0.70) and host carbohydrate vs. chlorophyll a (R^2^ = 0.76).  

Compared to both *S. siderea* and *P. strigosa*, fewer physiological traits were significantly (p < 0.05) correlated with one another in *P. astreoides* (12 significant out of 21 total comparisons; **Figure 2C**). Of the significant correlations, only two pairwise comparisons resulted in a Pearson's correlation coefficient greater than 0.5: chlorophyll a vs. color intensity (R^2^ = 0.57) and host carbohydrate vs. host protein (R^2^ = 0.68).

#################################################

```{r actual correlation matrix plot}
## Final correlation plot (and saving it as PDF)
# Rmarkdown plotting version
par(mfrow=c(2,2))
corrplot.mixed(C_corr_df2$r, upper = "ellipse", p.mat = C_corr_df2$P, sig.level = c(.001, .01, .05), insig = "blank", tl.col = "#0072B2", tl.cex = 1.5, title = "Control", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")

corrplot.mixed(S_corr_df2$r, upper = "ellipse",  sig.level = c(.001, .01, .05), insig = "blank", tl.col = "#0072B2", tl.cex = 1.5, title = "Sprinkler", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")

corrplot.mixed(F_corr_df2$r, upper = "ellipse",  sig.level = c(.001, .01, .05), insig = "blank", tl.col = "#0072B2", tl.cex = 1.5, title = "Feeding", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")

corrplot.mixed(I_corr_df2$r, upper = "ellipse",  p.mat = I_corr_df2$P,  insig = "blank", tl.col = "#0072B2", tl.cex = 1.5, title = "Interactive", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")
# genotype
corrplot.mixed(K2_corr_df2$r, upper = "ellipse",  sig.level = c(.001, .01, .05), insig = "blank", tl.col = "#0072B2", tl.cex = 1.5, title = "K2", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")

corrplot.mixed(M5_corr_df2$r, upper = "ellipse",  p.mat = M5_corr_df2$P, sig.level = c(.001, .01, .05), insig = "blank", tl.col = "#0072B2", tl.cex = 1.5, title = "M5", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")

corrplot.mixed(M6_corr_df2$r, upper = "ellipse",  sig.level = c(.001, .01, .05), insig = "blank", tl.col = "#0072B2", tl.cex = 1.5, title = "M6", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")

```


```{r actual correlation matrix plot}
## Final correlation plot (and saving it as PDF)
# Rmarkdown plotting version
par(mfrow=c(2,2))
corrplot.mixed(C_corr_df2l$r, upper = "ellipse", sig.level = c(.001, .01, .05), insig = "blank", tl.col = "#0072B2", tl.cex = 1.5, title = "Control", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")

corrplot.mixed(S_corr_df2l$r, upper = "ellipse",  sig.level = c(.001, .01, .05), insig = "blank", tl.col = "#0072B2", tl.cex = 1.5, title = "Sprinkler", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")

corrplot.mixed(F_corr_df2l$r, upper = "ellipse",  sig.level = c(.001, .01, .05), insig = "blank", tl.col = "#0072B2", tl.cex = 1.5, title = "Feeding", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")

corrplot.mixed(I_corr_df2l$r, upper = "ellipse",  p.mat = I_corr_df2l$P,  insig = "blank", tl.col = "#0072B2", tl.cex = 1.5, title = "Interactive", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")
# genotype
corrplot.mixed(K2_corr_df2l$r, upper = "ellipse",  sig.level = c(.001, .01, .05), insig = "blank", tl.col = "#0072B2", tl.cex = 1.5, title = "K2", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")

corrplot.mixed(M5_corr_df2l$r, upper = "ellipse",  sig.level = c(.001, .01, .05), insig = "blank", tl.col = "#0072B2", tl.cex = 1.5, title = "M5", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")

corrplot.mixed(M6_corr_df2l$r, upper = "ellipse",  sig.level = c(.001, .01, .05), insig = "blank", tl.col = "#0072B2", tl.cex = 1.5, title = "M6", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")

```

```{r}
# genotype
corrplot.mixed(K2_corr_df2$r, upper = "ellipse",  sig.level = c(.001, .01, .05), insig = "blank", tl.col = "#0072B2", tl.cex = 1.5, title = "K2", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")

corrplot.mixed(M5a_corr_df2$r, upper = "ellipse",  sig.level = c(.001, .01, .05), insig = "blank", tl.col = "#0072B2", tl.cex = 1.5, title = "M5", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")

corrplot.mixed(M6a_corr_df2$r, upper = "ellipse",  sig.level = c(.001, .01, .05), insig = "blank", tl.col = "#0072B2", tl.cex = 1.5, title = "M6", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")

# genotype
corrplot.mixed(K2a_corr_df2l$r, upper = "ellipse",  sig.level = c(.001, .01, .05), insig = "blank", tl.col = "#0072B2", tl.cex = 1.5, title = "K2", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")

corrplot.mixed(M5a_corr_df2l$r, upper = "ellipse",  sig.level = c(.001, .01, .05), insig = "blank", tl.col = "#0072B2", tl.cex = 1.5, title = "M5", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")

corrplot.mixed(M6a_corr_df2l$r, upper = "ellipse",  sig.level = c(.001, .01, .05), insig = "blank", tl.col = "#0072B2", tl.cex = 1.5, title = "M6", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")

# Cat
corr_df2

corrplot.mixed(corr_df2$r, upper = "ellipse",  sig.level = c(.001, .01, .05), insig = "blank", tl.col = "#0072B2", tl.cex = 1.5, title = "All", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")

corr_df2l

corrplot.mixed(corr_df2l$r, upper = "ellipse",  sig.level = c(.001, .01, .05), insig = "blank", tl.col = "#0072B2", tl.cex = 1.5, title = "All Logged", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")


```


<br/>

**Figure S1.** Correlation matrix for treatments and genotypes depicting pair-wise comparisons of physiological parameters within each treatment and across each genotype. Colour and ellipse width denote R^2^ of each significant comparison, and blank grids represent non-significant pair-wise comparisons (*P* > 0.05).Each parameter is denoted in <span style="color: #0072B2;">blue</span> text along the diagonal of each plot. Correlations with R^2^ above 0.5 (shown in <span style="color: #E67D00;">orange</span> and <span style="color: #F21A00;">red</span> in matrix plot) are explored further below.

<br/>

```{r save correlation plot, message=FALSE, warning=FALSE, include=FALSE}
# below saves the figure

par(mfrow=c(2,2))

corrplot.mixed(C_corr_df2$r, upper = "ellipse", number.cex = 0.8, p.mat = C_corr_df2$P, sig.level = c(.001, .01, .05), insig = "blank", tl.col = "#0072B2", tl.cex = 1, title ="Control", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")

corrplot.mixed(S_corr_df2$r, upper = "ellipse", number.cex = 0.8, p.mat = S_corr_df2$P, sig.level = c(.001, .01, .05), insig = "blank", tl.col = "#0072B2", tl.cex = 1, title = "Sprinkler", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")

corrplot.mixed(F_corr_df2$r, upper = "ellipse",  number.cex = 0.8, p.mat = F_corr_df2$P, sig.level = c(.001, .01, .05), insig = "blank", tl.col = "#0072B2", tl.cex = 1, title = "Feeding", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")

corrplot.mixed(I_corr_df2$r, upper = "ellipse",  number.cex = 0.8, p.mat = I_corr_df2$P, sig.level = c(.001, .01, .05), insig = "blank", tl.col = "#0072B2", tl.cex = 1, title = "Interactive", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")

#Genotype
corrplot.mixed(K2_corr_df2$r, upper = "ellipse", number.cex = 0.8, p.mat = K2_corr_df2$P, sig.level = c(.001, .01, .05), insig = "blank", tl.col = "#0072B2", tl.cex = 1, title = "K2", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")

corrplot.mixed(M5_corr_df2$r, upper = "ellipse",  number.cex = 0.8, p.mat = M5_corr_df2$P, sig.level = c(.001, .01, .05), insig = "blank", tl.col = "#0072B2", tl.cex = 1, title = "M5", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")

corrplot.mixed(M6_corr_df2$r, upper = "ellipse",  number.cex = 0.8, p.mat = M6_corr_df2$P, sig.level = c(.001, .01, .05), insig = "blank", tl.col = "#0072B2", tl.cex = 1, title = "M6", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")


### Treatment with Pmax
corrplot.mixed(S_corrp_df2$r, upper = "ellipse", number.cex = 0.8, p.mat = S_corrp_df2$P, sig.level = c(.001, .01, .05), insig = "blank", tl.col = "#0072B2", tl.cex = 1, title = "Sprinkler", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")

corrplot.mixed(F_corrp_df2$r, upper = "ellipse",  number.cex = 0.8, p.mat = F_corrp_df2$P, sig.level = c(.001, .01, .05), insig = "blank", tl.col = "#0072B2", tl.cex = 1, title = "Feeding", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")

corrplot.mixed(I_corrp_df2$r, upper = "ellipse",  number.cex = 0.8, p.mat = I_corrp_df2$P, sig.level = c(.001, .01, .05), insig = "blank", tl.col = "#0072B2", tl.cex = 1, title = "Interactive", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")

corrplot.mixed(C_corr_df2$r, upper = "ellipse", number.cex = 0.8, p.mat = C_corr_df2$P, sig.level = c(.001, .01, .05), insig = "blank", tl.col = "#0072B2", tl.cex = 1, title ="Control", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")

#Genotype with Pmax
corrplot.mixed(K2_corrp_df2$r, upper = "ellipse", number.cex = 0.8, p.mat = K2_corrp_df2$P, sig.level = c(.001, .01, .05), insig = "blank", tl.col = "#0072B2", tl.cex = 1, title = "K2", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")

corrplot.mixed(M5_corrp_df2$r, upper = "ellipse",  number.cex = 0.8, p.mat = M5_corrp_df2$P, sig.level = c(.001, .01, .05), insig = "blank", tl.col = "#0072B2", tl.cex = 1, title = "M5", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")

corrplot.mixed(M6_corrp_df2$r, upper = "ellipse",  number.cex = 0.8, p.mat = M6_corrp_df2$P, sig.level = c(.001, .01, .05), insig = "blank", tl.col = "#0072B2", tl.cex = 1, title = "M6", cl.lim = c(0,1), mar=c(0,0,1,0), cl.align.text = "l")
```


```{r scatter plots, fig.width = 7, fig.height = 12}


C_denVrate <- ggplot(data = df_90, aes(x =treatment , y =Zoox , group = genotype)) +
  theme_classic() +
  theme(legend.position = "none") +
  xlab("Treatment") + 
  ylab(dlab) +
  #scale_colour_manual("pCO2", labels = c("pre industrial", "current", "end-of-century", "extreme"), values = c("#b2abd2", "#5e3c99", "#fdb863", "#e66101")) +
  #scale_shape_manual("temperature", labels = c("28C", "31C"), values = c(19,1)) +
  #\geom_smooth(method = "lm", aes(group = fpco2), se = FALSE) +
  stat_cor(label.y = -0.5, label.x = 3.9) +
  stat_regline_equation(label.y = -0.7, label.x = 3.9) +
  geom_point()
C_denVrate
```


```{r}
# set up the dataframe
df_subset <- unique(df_subset)# remove any duplicate rows
ldf_subset <- gather(df_subset, param, value, c(4:6, 8))
treat_pca_df <- df_subset[,c(4:6, 8)]

# run the adonis
T_pca_mod <- adonis2(treat_pca_df ~ treatment * genotype, data = df_subset, method = 'eu', permutations = 1000) # below is the model with non sig interactions removed:
#treatment           3   154.68 0.14580 2.9374 0.01998 *
#genotype            2    92.42 0.08712 2.6327 0.07193 .
#treatment:genotype  6   181.88 0.17144 1.7269 0.09990 .
T_pca_mod <- adonis2(treat_pca_df ~ treatment, data = df_subset, by="margin", method = 'eu', permutations = bootnum)
T_pca_mod # view SSID adonis output
#  0.04648 *
# extract pvalues
T_pval <- T_pca_mod["Pr(>F)"]

# perform principal component analysis (PCA)
T_pca <- prcomp(treat_pca_df, center = TRUE, scale= TRUE)
```

```{r SSID PCA plot, fig.height=8, fig.width=8}
# create labels for p values calculated above
T_treat_pval <-substitute(italic(P[treatment])==p, list(p = format(T_pval[1,1], digits = 2)))
#0.041


# Treatment
T_treat_pca <- autoplot(T_pca, data = df_subset, 
         colour = "treatment",
         shape = "treatment",
         fill = "treatment",               
         frame = TRUE, 
         frame.type = "norm",
         frame.alpha = 0.01,
         loadings = TRUE, 
         loadings.colour = "black", 
         loadings.label = TRUE,
         loadings.label.colour = "black",         
         loadings.label.size = 4, 
         loadings.label.hjust = 1.5, 
         loadings.label.vjust = 0.5,
         loadings.label.repel = TRUE) +
 # scale_shape_manual("treatment", labels = c("Sprinkler", "Feeding", "Interactive", "Control"), values = c("T1","T2","T3","Tc")) +
  #scale_colour_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
  #scale_fill_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
    guides(color = guide_legend(keyheight = 0.3, nrow = 4, byrow = TRUE, override.aes = list(linetype = c(0, 0)))) +
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(),strip.background = element_blank(), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.title = element_blank(), legend.background = element_rect(fill = "transparent", colour = NA)) +
  annotate("text", x = -0.45, y = -0.35, label = deparse(T_treat_pval), parse = TRUE, size = 3)

T_treat_pca
ggsave("T_treat_pca.pdf", width = 10, height = 14, units = "in")
```

```{r}

# set up the dataframe
df_subset <- unique(df_subset)# remove any duplicate rows
ldf_subset <- gather(df_subset, param, value, c(4:6, 8))
geno_pca_df <- df_subset[,c(4:6, 8)]

# run the adonis
I_pca_mod <- adonis2(geno_pca_df ~ treatment * genotype, data = df_subset, method = 'eu', permutations = 1000) # below is the model with non sig interactions removed:
#treatment           3   154.68 0.14580 2.9374 0.02697 *
#genotype            2    92.42 0.08712 2.6327 0.06094 .
#treatment:genotype  6   181.88 0.17144 1.7269 0.07792 .
G_pca_mod <- adonis2(geno_pca_df ~ genotype, data = df_subset, by="margin", method = 'eu', permutations = bootnum)
G_pca_mod # view SSID adonis output
#  0.08796 *
# extract pvalues
G_pval <- G_pca_mod["Pr(>F)"]

# perform principal component analysis (PCA)
G_pca <- prcomp(geno_pca_df, center = TRUE, scale= TRUE)
```

```{r SSID PCA plot, fig.height=8, fig.width=8}
# create labels for p values calculated above
G_geno_pval <-substitute(italic(P[genotype])==p, list(p = format(G_pval[1,1], digits = 2)))
# 0.11


# Treatment
G_geno_pca <- autoplot(G_pca, data = df_subset, 
         colour = "genotype",
         shape = "genotype",
         fill = "genotype",               
         frame = TRUE, 
         frame.type = "norm",
         frame.alpha = 0.01,
         loadings = TRUE, 
         loadings.colour = "black", 
         loadings.label = TRUE,
         loadings.label.colour = "black",         
         loadings.label.size = 4, 
         loadings.label.hjust = 1.5, 
         loadings.label.vjust = 0.5,
         loadings.label.repel = TRUE) +
 # scale_shape_manual("treatment", labels = c("Sprinkler", "Feeding", "Interactive", "Control"), values = c("T1","T2","T3","Tc")) +
  #scale_colour_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
  #scale_fill_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
    guides(color = guide_legend(keyheight = 0.3, nrow = 4, byrow = TRUE)) +
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(),strip.background = element_blank(), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.title = element_blank(), legend.background = element_rect(fill = "transparent", colour = NA)) +
  annotate("text", x = -0.45, y = -0.2, label = deparse(G_geno_pval), parse = TRUE, size = 3)

G_geno_pca
ggsave("G_geno_pca.pdf", width = 10, height = 14, units = "in")


C_pca_mod <- adonis2(geno_pca_df ~ cat, data = df_subset, by="margin", method = 'eu', permutations = bootnum)
C_pca_mod # view SSID adonis output
#  0.01649 *  *
# extract pvalues
C_pval <- C_pca_mod["Pr(>F)"]

# perform principal component analysis (PCA)
C_pca <- prcomp(geno_pca_df, center = TRUE, scale= TRUE)
```

```{r SSID PCA plot, fig.height=8, fig.width=8}
# create labels for p values calculated above
C_cat_pval <-substitute(italic(P[cat])==p, list(p = format(C_pval[1,1], digits = 2)))
# 0.014


# Treatment
C_cat_pca <- autoplot(C_pca, data = df_subset, 
         colour = "cat",
         shape = "cat",
         fill = "cat",               
         frame = TRUE, 
         frame.type = "norm",
         frame.alpha = 0.01,
         loadings = TRUE, 
         loadings.colour = "black", 
         loadings.label = TRUE,
         loadings.label.colour = "black",         
         loadings.label.size = 4, 
         loadings.label.hjust = 1.5, 
         loadings.label.vjust = 0.5,
         loadings.label.repel = TRUE) +
 # scale_shape_manual("treatment", labels = c("Sprinkler", "Feeding", "Interactive", "Control"), values = c("T1","T2","T3","Tc")) +
  #scale_colour_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
  #scale_fill_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
    guides(color = guide_legend(keyheight = 0.3, nrow = 4, byrow = TRUE, override.aes = list(linetype = c(0, 0)))) +
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(),strip.background = element_blank(), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.title = element_blank(), legend.background = element_rect(fill = "transparent", colour = NA)) +
  annotate("text", x = -1, y = -.75, label = deparse(C_cat_pval), parse = TRUE, size = 3)

C_cat_pca

ggsave("C_cat_pca.pdf", width = 10, height = 14, units = "in")

plot_grid(G_geno_pca,C_cat_pca,T_treat_pca)
#########

```

# Genotype difference across treatments (Control)
```{r}
C_df

# set up the dataframe
C_df <- unique(C_df)# remove any duplicate rows
Cldf_subset <- gather(C_df, param, value, c(4:6, 8))
Cg_pca_df <- C_df[,c(4:6, 8)]

# run the adonis
Cg_pca_mod <- adonis2(Cg_pca_df ~  genotype, data = C_df, method = 'eu', permutations = 1000) # below is the model with non sig interactions removed:
#0.5844

# extract pvalues
Cg_pval <- Cg_pca_mod["Pr(>F)"]

# perform principal component analysis (PCA)
Cg_pca <- prcomp(Cg_pca_df, center = TRUE, scale= TRUE)
```


```{r SSID PCA plot, fig.height=8, fig.width=8}
# create labels for p values calculated above
Cg_con_pval <-substitute(italic(P[genotype])==p, list(p = format(Cg_pval[1,1], digits = 2)))
# 0.59


# Treatment
Cg_con_pca <- autoplot(Cg_pca, data = C_df, 
         colour = "genotype",
         shape = "genotype",
         fill = "genotype",               
         frame = TRUE, 
         frame.type = "norm",
         frame.alpha = 0.01,
         loadings = TRUE, 
         loadings.colour = "black", 
         loadings.label = TRUE,
         loadings.label.colour = "black",         
         loadings.label.size = 4, 
         loadings.label.hjust = 1.5, 
         loadings.label.vjust = 0.5,
         loadings.label.repel = TRUE) +
 # scale_shape_manual("treatment", labels = c("Sprinkler", "Feeding", "Interactive", "Control"), values = c("T1","T2","T3","Tc")) +
  #scale_colour_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
  #scale_fill_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
    guides(color = guide_legend(keyheight = 0.3, nrow = 4, byrow = TRUE)) +
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(),strip.background = element_blank(), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.title = element_blank(), legend.background = element_rect(fill = "transparent", colour = NA)) +
  annotate("text", x = -1, y = -.75, label = deparse(Cg_con_pval), parse = TRUE, size = 3)

Cg_con_pca

ggsave("Cg_con_pca.pdf", width = 10, height = 14, units = "in")

```


# Genotype difference across treatments (Sprinkler)
```{r}
S_df

# set up the dataframe
S_df <- unique(S_df)# remove any duplicate rows
Sldf_subset <- gather(S_df, param, value, c(4:6, 8))
Sg_pca_df <- S_df[,c(4:6, 8)]

# run the adonis
Sg_pca_mod <- adonis2(Sg_pca_df ~  genotype, data = S_df, method = 'eu', permutations = 1000) # below is the model with non sig interactions removed:
#0.006993

# extract pvalues
Sg_pval <- Sg_pca_mod["Pr(>F)"]

# perform principal component analysis (PCA)
Sg_pca <- prcomp(Sg_pca_df, center = TRUE, scale= TRUE)
```


```{r SSID PCA plot, fig.height=8, fig.width=8}
# create labels for p values calculated above
Sg_spr_pval <-substitute(italic(P[genotype])==p, list(p = format(Sg_pval[1,1], digits = 2)))
# 0.007


#
Sg_spr_pca <- autoplot(Sg_pca, data = S_df, 
         colour = "genotype",
         shape = "genotype",
         fill = "genotype",               
         frame = TRUE, 
         frame.type = "norm",
         frame.alpha = 0.01,
         loadings = TRUE, 
         loadings.colour = "black", 
         loadings.label = TRUE,
         loadings.label.colour = "black",         
         loadings.label.size = 4, 
         loadings.label.hjust = 1.5, 
         loadings.label.vjust = 0.5,
         loadings.label.repel = TRUE) +
 # scale_shape_manual("treatment", labels = c("Sprinkler", "Feeding", "Interactive", "Control"), values = c("T1","T2","T3","Tc")) +
  #scale_colour_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
  #scale_fill_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
    guides(color = guide_legend(keyheight = 0.3, nrow = 4, byrow = TRUE)) +
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(),strip.background = element_blank(), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.title = element_blank(), legend.background = element_rect(fill = "transparent", colour = NA)) +
  annotate("text", x = -1, y = -.75, label = deparse(Sg_spr_pval), parse = TRUE, size = 3)

Sg_spr_pca

ggsave("Sg_spr_pca.pdf", width = 10, height = 14, units = "in")

```

# Genotype difference across treatments (Feeding)
```{r}
F_df

# set up the dataframe
F_df <- unique(F_df)# remove any duplicate rows
Fldf_subset <- gather(F_df, param, value, c(4:6, 8))
Fg_pca_df <- F_df[,c(4:6, 8)]

# run the adonis
Fg_pca_mod <- adonis2(Fg_pca_df ~  genotype, data = F_df, method = 'eu', permutations = 1000) # below is the model with non sig interactions removed:
#0.1788

# extract pvalues
Fg_pval <- Fg_pca_mod["Pr(>F)"]

# perform principal component analysis (PCA)
Fg_pca <- prcomp(Fg_pca_df, center = TRUE, scale= TRUE)
```


```{r SSID PCA plot, fig.height=8, fig.width=8}
# create labels for p values calculated above
Fg_fee_pval <-substitute(italic(P[genotype])==p, list(p = format(Fg_pval[1,1], digits = 2)))
# 0.18


#
Fg_fee_pca <- autoplot(Fg_pca, data = F_df, 
         colour = "genotype",
         shape = "genotype",
         fill = "genotype",               
         frame = TRUE, 
         frame.type = "norm",
         frame.alpha = 0.01,
         loadings = TRUE, 
         loadings.colour = "black", 
         loadings.label = TRUE,
         loadings.label.colour = "black",         
         loadings.label.size = 4, 
         loadings.label.hjust = 1.5, 
         loadings.label.vjust = 0.5,
         loadings.label.repel = TRUE) +
 # scale_shape_manual("treatment", labels = c("Sprinkler", "Feeding", "Interactive", "Control"), values = c("T1","T2","T3","Tc")) +
  #scale_colour_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
  #scale_fill_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
    guides(color = guide_legend(keyheight = 0.3, nrow = 4, byrow = TRUE)) +
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(),strip.background = element_blank(), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.title = element_blank(), legend.background = element_rect(fill = "transparent", colour = NA)) +
  annotate("text", x = -1, y = -.75, label = deparse(Fg_fee_pval), parse = TRUE, size = 3)

Fg_fee_pca

ggsave("Fg_fee_pca.pdf", width = 10, height = 14, units = "in")

```

# Genotype difference across treatments (Interactive)
```{r}
I_df

# set up the dataframe
I_df <- unique(I_df)# remove any duplicate rows
Ildf_subset <- gather(I_df, param, value, c(4:6, 8))
Ig_pca_df <- I_df[,c(4:6, 8)]

# run the adonis
Ig_pca_mod <- adonis2(Ig_pca_df ~  genotype, data = I_df, method = 'eu', permutations = 1000) # below is the model with non sig interactions removed:
#0.3287

# extract pvalues
Ig_pval <- Ig_pca_mod["Pr(>F)"]

# perform principal component analysis (PCA)
Ig_pca <- prcomp(Ig_pca_df, center = TRUE, scale= TRUE)
```


```{r SSID PCA plot, fig.height=8, fig.width=8}
# create labels for p values calculated above
Ig_int_pval <-substitute(italic(P[genotype])==p, list(p = format(Ig_pval[1,1], digits = 2)))
# 0.33


#
Ig_int_pca <- autoplot(Ig_pca, data = I_df, 
         colour = "genotype",
         shape = "genotype",
         fill = "genotype",               
         frame = TRUE, 
         frame.type = "norm",
         frame.alpha = 0.01,
         loadings = TRUE, 
         loadings.colour = "black", 
         loadings.label = TRUE,
         loadings.label.colour = "black",         
         loadings.label.size = 4, 
         loadings.label.hjust = 1.5, 
         loadings.label.vjust = 0.5,
         loadings.label.repel = TRUE) +
 # scale_shape_manual("treatment", labels = c("Sprinkler", "Feeding", "Interactive", "Control"), values = c("T1","T2","T3","Tc")) +
  #scale_colour_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
  #scale_fill_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
    guides(color = guide_legend(keyheight = 0.3, nrow = 4, byrow = TRUE)) +
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(),strip.background = element_blank(), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.title = element_blank(), legend.background = element_rect(fill = "transparent", colour = NA)) +
  annotate("text", x = -1, y = -.75, label = deparse(Ig_int_pval), parse = TRUE, size = 3)

Ig_int_pca

ggsave("Ig_int_pca.pdf", width = 10, height = 14, units = "in")

```

SP data Final PCAs
df_sp

```{r}



# set up the dataframe
df_sp <- unique(df_sp)# remove any duplicate rows
ldf_sp <- gather(df_sp, param, value, c(4:5, 7:8))
treat_pca_dfsp <- df_sp[,c(4:5, 7:8)]

# run the adonis
Tsp_pca_mod <- adonis2(treat_pca_dfsp ~ treatment * genotype, data = df_sp, method = 'eu', permutations = 1000) # below is the model with non sig interactions removed:
#treatment           3    6.576 0.06229 1.0704 0.370629    
#genotype            2   16.762 0.15880 4.0928 0.007992 ***
#treatment:genotype  6    8.501 0.08054 0.6919 0.729271
Tsp_pca_mod <- adonis2(treat_pca_dfsp ~ treatment, data = df_sp, by="margin", method = 'eu', permutations = bootnum)
Tsp_pca_mod # view SSID adonis output
#  0.4254
# extract pvalues
Tsp_pval <- Tsp_pca_mod["Pr(>F)"]

# perform principal component analysis (PCA)
Tsp_pca <- prcomp(treat_pca_dfsp, center = TRUE, scale= TRUE)
```

```{r SSID PCA plot, fig.height=8, fig.width=8}
# create labels for p values calculated above
Tsp_treat_pval <-substitute(italic(P[treatment])==p, list(p = format(Tsp_pval[1,1], digits = 2)))
#0.34


# Treatment
Tsp_treat_pca <- autoplot(Tsp_pca, data = df_sp, 
         colour = "treatment",
         shape = "treatment",
         fill = "treatment",               
         frame = TRUE, 
         frame.type = "norm",
         frame.alpha = 0,
         loadings = TRUE, 
         loadings.colour = "black", 
         loadings.label = TRUE,
         loadings.label.colour = "black",         
         loadings.label.size = 5, 
         loadings.label.hjust = 1.5, 
         loadings.label.vjust = 0.5,
         loadings.label.repel = TRUE) +
   scale_color_manual(values = c('#66CCFF','#FFFF00', '#FF00CC', '#66FF33'))+
 scale_fill_discrete( labels=c("Sprinkler", "Feeding", "Interactive","Control"))+
 # scale_shape_manual("treatment", labels = c("Sprinkler", "Feeding", "Interactive", "Control"), values = c("T1","T2","T3","Tc")) +
  #scale_colour_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
  #scale_fill_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
    guides(color = guide_legend(keyheight = 0.3, nrow = 4, byrow = TRUE, override.aes = list(linetype = c(0, 0)))) +
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(),strip.background = element_blank(), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.title = element_blank(), legend.background = element_rect(fill = "transparent", colour = NA)) +
  annotate("text", x = -0.45, y = -0.35, label = deparse(Tsp_treat_pval), parse = TRUE, size = 3)

Tsp_treat_pca
ggsave("Tsp_treat_pca.pdf")
```

```{r}

# set up the dataframe
df_sp <- unique(df_sp)# remove any duplicate rows
ldf_sp <- gather(df_sp, param, value, c(4:5, 7:8))
geno_pca_dfsp <- df_sp[,c(4:5, 7:8)]


Gsp_pca_mod <- adonis2(geno_pca_dfsp ~ genotype, data = df_sp, by="margin", method = 'eu', permutations = bootnum)
Gsp_pca_mod # view SSID adonis output
#  0.0064978 *
# extract pvalues
Gsp_pval <- Gsp_pca_mod["Pr(>F)"]

# perform principal component analysis (PCA)
Gsp_pca <- prcomp(geno_pca_dfsp, center = TRUE, scale= TRUE)
```

```{r SSID PCA plot, fig.height=8, fig.width=8}
# create labels for p values calculated above
Gsp_geno_pval <-substitute(italic(P[genotype])==p, list(p = format(Gsp_pval[1,1], digits = 2)))
# 0.0065


# Treatment
Gsp_geno_pca <- autoplot(Gsp_pca, data = df_sp, 
         colour = "genotype",
         shape = "genotype",
         fill = "genotype",               
         frame = TRUE, 
         frame.type = "norm",
         frame.alpha = 0,
         loadings = TRUE, 
         loadings.colour = "black", 
         loadings.label = TRUE,
         loadings.label.colour = "black",         
         loadings.label.size = 5, 
         loadings.label.hjust = 1.5, 
         loadings.label.vjust = 0.5,
         loadings.label.repel = TRUE) +
  scale_fill_manual(values = c('red','green4', 'blue'))+
 # scale_shape_manual("treatment", labels = c("Sprinkler", "Feeding", "Interactive", "Control"), values = c("T1","T2","T3","Tc")) +
  #scale_colour_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
  #scale_fill_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
    guides(color = guide_legend(keyheight = 0.3, nrow = 4, byrow = TRUE)) +
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(),strip.background = element_blank(), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.title = element_blank(), legend.background = element_rect(fill = "transparent", colour = NA)) +
  annotate("text", x = -0.4, y = -0.4, label = deparse(Gsp_geno_pval), parse = TRUE, size = 3)

Gsp_geno_pca
ggsave("Gsp_geno_pca.pdf")


Csp_pca_mod <- adonis2(geno_pca_dfsp ~ cat, data = df_sp, by="margin", method = 'eu', permutations = bootnum)
Csp_pca_mod # view SSID adonis output
#   0.1404 *  *
# extract pvalues
Csp_pval <- Csp_pca_mod["Pr(>F)"]

# perform principal component analysis (PCA)
Csp_pca <- prcomp(geno_pca_dfsp, center = TRUE, scale= TRUE)
```

```{r SSID PCA plot, fig.height=8, fig.width=8}
# create labels for p values calculated above
Csp_cat_pval <-substitute(italic(P[cat])==p, list(p = format(Csp_pval[1,1], digits = 2)))
# 0.14


# Interactive
Csp_cat_pca <- autoplot(Csp_pca, data = df_sp, 
         colour = "cat",
         fill = "cat",               
         frame = TRUE, 
         frame.type = "norm",
         frame.alpha = 0,
         loadings = TRUE, 
         loadings.colour = "black", 
         loadings.label = TRUE,
         loadings.label.colour = "black",         
         loadings.label.size = 5, 
         loadings.label.hjust = -4, 
         loadings.label.vjust = 0.5,
         loadings.label.repel = TRUE) +
 # scale_shape_manual("treatment", labels = c("Sprinkler", "Feeding", "Interactive", "Control"), values = c("T1","T2","T3","Tc")) +
  #scale_colour_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
  #scale_fill_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
    guides(color = guide_legend(keyheight = 0.3, nrow = 4, byrow = TRUE, override.aes = list(linetype = c(0, 0)))) +
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(),strip.background = element_blank(), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.title = element_blank(), legend.background = element_rect(fill = "transparent", colour = NA)) +
  annotate("text", x = -.75, y = -.75, label = deparse(Csp_cat_pval), parse = TRUE, size = 3)

Csp_cat_pca

ggsave("Csp_cat_pca.pdf")

plot_grid(Gsp_geno_pca,Csp_cat_pca,Tsp_treat_pca)
#########

```

# Genotype difference across treatments (Control)
```{r}
C_dfsp

# set up the dataframe
C_dfsp <- unique(C_dfsp)# remove any duplicate rows
Cldf_sp <- gather(C_dfsp, param, value, c(4:5, 7:8))
Cg_pca_dfsp <- C_dfsp[,c(4:5, 7:8)]

# run the adonis
Cspg_pca_mod <- adonis2(Cg_pca_dfsp ~  genotype, data = C_dfsp, method = 'eu', permutations = 1000) # below is the model with non sig interactions removed:
#0.2198

# extract pvalues
Cspg_pval <- Cspg_pca_mod["Pr(>F)"]

# perform principal component analysis (PCA)
Cspg_pca <- prcomp(Cg_pca_dfsp, center = TRUE, scale= TRUE)
```


```{r SSID PCA plot, fig.height=8, fig.width=8}
# create labels for p values calculated above
Cspg_con_pval <-substitute(italic(P[genotype])==p, list(p = format(Cspg_pval[1,1], digits = 2)))
# 0.22


# Treatment
Cspg_con_pca <- autoplot(Cspg_pca, data = C_dfsp, 
         colour = "genotype",
         shape = "genotype",
         fill = "genotype",               
         frame = TRUE, 
         frame.type = "norm",
         frame.alpha = 0,
         loadings = TRUE, 
         loadings.colour = "black", 
         loadings.label = TRUE,
         loadings.label.colour = "black",         
         loadings.label.size = 5, 
         loadings.label.hjust = 1.5, 
         loadings.label.vjust =-.5,
         loadings.label.repel = TRUE) +
    scale_fill_manual(values = c('red','green4', 'blue'))+
 # scale_shape_manual("treatment", labels = c("Sprinkler", "Feeding", "Interactive", "Control"), values = c("T1","T2","T3","Tc")) +
  #scale_colour_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
  #scale_fill_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
    guides(color = guide_legend(keyheight = 0.3, nrow = 4, byrow = TRUE)) +
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(),strip.background = element_blank(), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.title = element_blank(), legend.background = element_rect(fill = "transparent", colour = NA)) +
  annotate("text", x = -1, y = -1, label = deparse(Cspg_con_pval), parse = TRUE, size = 3)

Cspg_con_pca

ggsave("Cspg_con_pca.pdf")

```


# Genotype difference across treatments (Sprinkler)
```{r}
S_dfsp

# set up the dataframe
S_dfsp <- unique(S_dfsp)# remove any duplicate rows
Sldf_sp <- gather(S_dfsp, param, value, c(4:5,7:8))
Sg_pca_dfsp <- S_dfsp[,c(4:5,7:8)]

# run the adonis
Sspg_pca_mod <- adonis2(Sg_pca_dfsp ~  genotype, data = S_dfsp, method = 'eu', permutations = 1000)
#0.1109

# extract pvalues
Sspg_pval <- Sspg_pca_mod["Pr(>F)"]

# perform principal component analysis (PCA)
Sspg_pca <- prcomp(Sg_pca_dfsp, center = TRUE, scale= TRUE)
```


```{r SSID PCA plot, fig.height=8, fig.width=8}
# create labels for p values calculated above
Sspg_spr_pval <-substitute(italic(P[genotype])==p, list(p = format(Sspg_pval[1,1], digits = 2)))
# 0.089


#
Sspg_spr_pca <- autoplot(Sspg_pca, data = S_dfsp, 
         colour = "genotype",
         shape = "genotype",
         fill = "genotype",               
         frame = TRUE, 
         frame.type = "norm",
         frame.alpha = 0,
         loadings = TRUE, 
         loadings.colour = "black", 
         loadings.label = TRUE,
         loadings.label.colour = "black",         
         loadings.label.size = 5, 
         loadings.label.hjust = 1.5, 
         loadings.label.vjust = 1,
         loadings.label.repel = TRUE) +
      scale_fill_manual(values = c('red','green4', 'blue'))+
 # scale_shape_manual("treatment", labels = c("Sprinkler", "Feeding", "Interactive", "Control"), values = c("T1","T2","T3","Tc")) +
  #scale_colour_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
  #scale_fill_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
    guides(color = guide_legend(keyheight = 0.3, nrow = 4, byrow = TRUE)) +
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(),strip.background = element_blank(), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.title = element_blank(), legend.background = element_rect(fill = "transparent", colour = NA)) +
  annotate("text", x = -1, y = -1.5, label = deparse(Sspg_spr_pval), parse = TRUE, size = 3)

Sspg_spr_pca

ggsave("Sspg_spr_pca.pdf")

```

# Genotype difference across treatments (Feeding)
```{r}
F_dfsp

# set up the dataframe
F_dfsp <- unique(F_dfsp)# remove any duplicate rows
Fldf_sp <- gather(F_dfsp, param, value, c(4:5,7:8))
Fg_pca_dfsp <- F_dfsp[,c(4:5,7:8)]

# run the adonis
Fspg_pca_mod <- adonis2(Fg_pca_dfsp ~  genotype, data = F_dfsp, method = 'eu', permutations = 1000) # below is the model with non sig interactions removed:
#0.3107

# extract pvalues
Fspg_pval <- Fspg_pca_mod["Pr(>F)"]

# perform principal component analysis (PCA)
Fspg_pca <- prcomp(Fg_pca_dfsp, center = TRUE, scale= TRUE)
```


```{r SSID PCA plot, fig.height=8, fig.width=8}
# create labels for p values calculated above
Fspg_fee_pval <-substitute(italic(P[genotype])==p, list(p = format(Fspg_pval[1,1], digits = 2)))
# 0.31


#
Fspg_fee_pca <- autoplot(Fspg_pca, data = F_dfsp, 
         colour = "genotype",
         shape = "genotype",
         fill = "genotype",               
         frame = TRUE, 
         frame.type = "norm",
         frame.alpha = 0,
         loadings = TRUE, 
         loadings.colour = "black", 
         loadings.label = TRUE,
         loadings.label.colour = "black",         
         loadings.label.size = 5, 
         loadings.label.hjust = -.5, 
         loadings.label.vjust = .5,
         loadings.label.repel = TRUE) +
        scale_fill_manual(values = c('red','green4', 'blue'))+
 # scale_shape_manual("treatment", labels = c("Sprinkler", "Feeding", "Interactive", "Control"), values = c("T1","T2","T3","Tc")) +
  #scale_colour_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
  #scale_fill_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
    guides(color = guide_legend(keyheight = 0.3, nrow = 4, byrow = TRUE)) +
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(),strip.background = element_blank(), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.title = element_blank(), legend.background = element_rect(fill = "transparent", colour = NA)) +
  annotate("text", x = -1, y = -1.2, label = deparse(Fspg_fee_pval), parse = TRUE, size = 3)

Fspg_fee_pca

ggsave("Fspg_fee_pca.pdf")

```

# Genotype difference across treatments (Interactive)
```{r}
I_dfsp

# set up the dataframe
I_dfsp <- unique(I_dfsp)# remove any duplicate rows
Ildf_sp <- gather(I_dfsp, param, value, c(4:5,7:8))
Ig_pca_dfsp <- I_dfsp[,c(4:5,7:8)]

# run the adonis
Ispg_pca_mod <- adonis2(Ig_pca_dfsp ~  genotype, data = I_dfsp, method = 'eu', permutations = 1000) # below is the model with non sig interactions removed:
#0.3117

# extract pvalues
Ispg_pval <- Ispg_pca_mod["Pr(>F)"]

# perform principal component analysis (PCA)
Ispg_pca <- prcomp(Ig_pca_dfsp, center = TRUE, scale= TRUE)
```


```{r SSID PCA plot, fig.height=8, fig.width=8}
# create labels for p values calculated above
Ispg_int_pval <-substitute(italic(P[genotype])==p, list(p = format(Ispg_pval[1,1], digits = 2)))
# 0.31


#
Ispg_int_pca <- autoplot(Ispg_pca, data = I_dfsp, 
         colour = "genotype",
         shape = "genotype",
         fill = "genotype",               
         frame = TRUE, 
         frame.type = "norm",
         frame.alpha = 0,
         loadings = TRUE, 
         loadings.colour = "black", 
         loadings.label = TRUE,
         loadings.label.colour = "black",         
         loadings.label.size = 5, 
         loadings.label.hjust = 1.5, 
         loadings.label.vjust = 0.5,
         loadings.label.repel = TRUE) +
        scale_fill_manual(values = c('red','green4', 'blue'))+
 # scale_shape_manual("treatment", labels = c("Sprinkler", "Feeding", "Interactive", "Control"), values = c("T1","T2","T3","Tc")) +
  #scale_colour_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
  #scale_fill_manual("temperature", labels = c("28C", "31C"), values = c("#0072B2", "#D55E00"))+
    guides(color = guide_legend(keyheight = 0.3, nrow = 4, byrow = TRUE)) +
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(),strip.background = element_blank(), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.title = element_blank(), legend.background = element_rect(fill = "transparent", colour = NA)) +
  annotate("text", x = -1, y = -1, label = deparse(Ispg_int_pval), parse = TRUE, size = 3)

Ispg_int_pca

ggsave("Ispg_int_pca.pdf")

```



<br/>
Figure:

```{r}
## load the protein bootstrapped model output
df_pro_a <- read.csv("LMER_model_outputs/Protein_model_2021-03-24.csv", head = TRUE)
df_pro_a$ftemp <- as.factor(df_pro_a$ftemp)
df_pro_a$fpco2 <- as.factor(df_pro_a$fpco2)
df_pro_a$species <- factor(df_pro_a$species, levels = c("SSID", "PSTR", "PAST", "UTEN"))

```


## Supplemental Tables{.tabset} 


```{r protein table}
pro_tab <- df_pro_a[,c(9,15,18:20)] #subset for species, treatment, parameter, and model values
pro_tab$binder <- paste(pro_tab$species, pro_tab$treat2, sep = "_")
T90_pro_mean <- summarySE(data=pro_tab, measurevar = "mean", groupvars = c("species", "treat2", "binder"))
T90_pro_low <- summarySE(data=pro_tab, measurevar = "lowerci", groupvars = c("species", "treat2", "binder"))
T90_pro_up <- summarySE(data=pro_tab, measurevar = "upperci", groupvars = c("species", "treat2", "binder"))
pro_tab <- cbind(T90_pro_mean, T90_pro_low, T90_pro_up)[, c(1,2,4,5,13,21)]
pro_tab$mean <- round(pro_tab$mean, 2)
pro_tab$lowerci <- round(pro_tab$lowerci, 2)
pro_tab$upperci <- round(pro_tab$upperci, 2)
colnames(pro_tab)[colnames(pro_tab)=="treat2"] <- "treatment"
colnames(pro_tab)[colnames(pro_tab)=="lowerci"] <- "lower 95%"
colnames(pro_tab)[colnames(pro_tab)=="upperci"] <- "upper 95%"
pro_tab$treatment <- factor(pro_tab$treatment, c("T0", "288_28", "311_31", "447_28", "405_31", "673_28", "701_31", "3285_28", "3309_31"))
table1 <- kable(pro_tab[,-c(1)], booktabs = T, caption = "Table 1. T90 modeled mean coral host protein content and 95% confidence intervals for each  species") %>%
  kable_styling(font_size = 10, full_width = F) %>% 
  pack_rows("(a) SSID", 1, 8) %>%
  pack_rows("(b) PSTR", 9, 16) %>%
  pack_rows("(c) PAST", 17, 24)
table1
```

```{r lipid table}
lipid_tab <- df_lipid_a[,c(9,15,18:20)] #subset for species, treatment, parameter, and model values
lipid_tab$binder <- paste(lipid_tab$species, lipid_tab$treat2, sep = "_")
T90_lipid_mean <- summarySE(data=lipid_tab, measurevar = "mean", groupvars = c("species", "treat2", "binder"))
T90_lipid_low <- summarySE(data=lipid_tab, measurevar = "lowerci", groupvars = c("species", "treat2", "binder"))
T90_lipid_up <- summarySE(data=lipid_tab, measurevar = "upperci", groupvars = c("species", "treat2", "binder"))
lipid_tab <- cbind(T90_lipid_mean, T90_lipid_low, T90_lipid_up)[, c(1,2,4,5,13,21)]
lipid_tab$mean <- round(lipid_tab$mean, 2)
lipid_tab$lowerci <- round(lipid_tab$lowerci, 2)
lipid_tab$upperci <- round(lipid_tab$upperci, 2)
colnames(lipid_tab)[colnames(lipid_tab)=="treat2"] <- "treatment"
colnames(lipid_tab)[colnames(lipid_tab)=="lowerci"] <- "lower 95%"
colnames(lipid_tab)[colnames(lipid_tab)=="upperci"] <- "upper 95%"
lipid_tab$treatment <- factor(lipid_tab$treatment, c("T0", "288_28", "311_31", "447_28", "405_31", "673_28", "701_31", "3285_28", "3309_31"))
table2 <- kable(lipid_tab[,-c(1)], booktabs = T, caption = "Table 2. T90 modeled mean coral host lipid content and 95% confidence intervals for each  species") %>%
  kable_styling(font_size = 10, full_width = F) %>% 
  pack_rows("(a) SSID", 1, 8) %>%
  pack_rows("(b) PSTR", 9, 16) %>%
  pack_rows("(c) PAST", 17, 24)
table2
```

```{r carbohydrate table}
carb_tab <- df_carb_a[,c(9,15,18:20)] #subset for species, treatment, and model values
carb_tab$binder <- paste(carb_tab$species, carb_tab$treat2, sep = "_")
T90_carb_mean <- summarySE(data=carb_tab, measurevar = "mean", groupvars = c("species", "treat2", "binder"))
T90_carb_low <- summarySE(data=carb_tab, measurevar = "lowerci", groupvars = c("species", "treat2", "binder"))
T90_carb_up <- summarySE(data=carb_tab, measurevar = "upperci", groupvars = c("species", "treat2", "binder"))
carb_tab <- cbind(T90_carb_mean, T90_carb_low, T90_carb_up)[, c(1,2,4,5,13,21)]
carb_tab$mean <- round(carb_tab$mean, 2)
carb_tab$lowerci <- round(carb_tab$lowerci, 2)
carb_tab$upperci <- round(carb_tab$upperci, 2)
colnames(carb_tab)[colnames(carb_tab)=="treat2"] <- "treatment"
colnames(carb_tab)[colnames(carb_tab)=="lowerci"] <- "lower 95%"
colnames(carb_tab)[colnames(carb_tab)=="upperci"] <- "upper 95%"
carb_tab$treatment <- factor(carb_tab$treatment, c("T0", "288_28", "311_31", "447_28", "405_31", "673_28", "701_31", "3285_28", "3309_31"))
table3 <- kable(carb_tab[,-c(1)], booktabs = T, caption = "Table 3. T90 modeled mean coral host carbohydrate content and 95% confidence intervals for each  species") %>%
  kable_styling(font_size = 10, full_width = F) %>% 
  pack_rows("(a) SSID", 1, 8) %>%
  pack_rows("(b) PSTR", 9, 16) %>%
  pack_rows("(c) PAST", 17, 24)
table3
```

```{r density table}
den_tab <- df_den_a[,c(9,15,18:20)] #subset for species, treatment, parameter, and model values
den_tab$binder <- paste(den_tab$species, den_tab$treat2, sep = "_")
T90_den_mean <- summarySE(data=den_tab, measurevar = "mean", groupvars = c("species", "treat2", "binder"))
T90_den_low <- summarySE(data=den_tab, measurevar = "lowerci", groupvars = c("species", "treat2", "binder"))
T90_den_up <- summarySE(data=den_tab, measurevar = "upperci", groupvars = c("species", "treat2", "binder"))
den_tab <- cbind(T90_den_mean, T90_den_low, T90_den_up)[, c(1,2,4,5,13,21)]
den_tab$mean <- round(den_tab$mean, 2)
den_tab$lowerci <- round(den_tab$lowerci, 2)
den_tab$upperci <- round(den_tab$upperci, 2)
colnames(den_tab)[colnames(den_tab)=="treat2"] <- "treatment"
colnames(den_tab)[colnames(den_tab)=="lowerci"] <- "lower 95%"
colnames(den_tab)[colnames(den_tab)=="upperci"] <- "upper 95%"
den_tab$treatment <- factor(den_tab$treatment, c("T0", "288_28", "311_31", "447_28", "405_31", "673_28", "701_31", "3285_28", "3309_31"))
table4 <- kable(den_tab[,-c(1)], booktabs = T, caption = "Table 4. T90 modeled mean algal endosymbiont cell density and 95% confidence intervals for each  species") %>%
  kable_styling(font_size = 10, full_width = F) %>% 
  pack_rows("(a) SSID", 1, 8) %>%
  pack_rows("(b) PSTR", 9, 16) %>%
  pack_rows("(c) PAST", 17, 24)
table4
```

```{r chlorophyll table}
chla_tab <- df_chla_a[,c(9,15,18:20)] #subset for species, treatment, parameter, and model values
chla_tab$binder <- paste(chla_tab$species, chla_tab$treat2, sep = "_")
T90_chla_mean <- summarySE(data=chla_tab, measurevar = "mean", groupvars = c("species", "treat2", "binder"))
T90_chla_low <- summarySE(data=chla_tab, measurevar = "lowerci", groupvars = c("species", "treat2", "binder"))
T90_chla_up <- summarySE(data=chla_tab, measurevar = "upperci", groupvars = c("species", "treat2", "binder"))
chla_tab <- cbind(T90_chla_mean, T90_chla_low, T90_chla_up)[, c(1,2,4,5,13,21)]
chla_tab$mean <- round(chla_tab$mean, 2)
chla_tab$lowerci <- round(chla_tab$lowerci, 2)
chla_tab$upperci <- round(chla_tab$upperci, 2)
colnames(chla_tab)[colnames(chla_tab)=="treat2"] <- "treatment"
colnames(chla_tab)[colnames(chla_tab)=="lowerci"] <- "lower 95%"
colnames(chla_tab)[colnames(chla_tab)=="upperci"] <- "upper 95%"
chla_tab$treatment <- factor(chla_tab$treatment, c("T0", "288_28", "311_31", "447_28", "405_31", "673_28", "701_31", "3285_28", "3309_31"))
table5 <- kable(chla_tab[,-c(1)], booktabs = T, caption = "Table 5. T90 modeled mean algal endosymbiont chlorophyll a content and 95% confichlace intervals for each  species") %>%
  kable_styling(font_size = 10, full_width = F) %>% 
  pack_rows("(a) SSID", 1, 8) %>%
  pack_rows("(b) PSTR", 9, 16) %>%
  pack_rows("(c) PAST", 17, 24)
table5
```

```{r host table}
host_tab <- df_host_a[,c(9,15,16,18:20)] #subset for species, treatment, parameter, and model values
host_tab$binder <- paste(host_tab$species, host_tab$param, host_tab$treat2, sep = "_")
T90_host_mean <- summarySE(data=host_tab, measurevar = "mean", groupvars = c("species", "param", "treat2", "binder"))
T90_host_low <- summarySE(data=host_tab, measurevar = "lowerci", groupvars = c("species", "param", "treat2", "binder"))
T90_host_up <- summarySE(data=host_tab, measurevar = "upperci", groupvars = c("species", "param", "treat2", "binder"))
host_tab <- cbind(T90_host_mean, T90_host_low, T90_host_up)[, c(1,3,5,6,15,24)]
host_tab$mean <- round(host_tab$mean, 2)
host_tab$lowerci <- round(host_tab$lowerci, 2)
host_tab$upperci <- round(host_tab$upperci, 2)
colnames(host_tab)[colnames(host_tab)=="treat2"] <- "treatment"
colnames(host_tab)[colnames(host_tab)=="lowerci"] <- "lower 95%"
colnames(host_tab)[colnames(host_tab)=="upperci"] <- "upper 95%"
host_tab$treatment <- factor(host_tab$treatment, c("T0", "288_28", "311_31", "447_28", "405_31", "673_28", "701_31", "3285_28", "3309_31"))
table6 <- kable(host_tab[,-c(1)], booktabs = T, caption = "Table 6. Total coral host physiology at T90 modeled mean and 95% confidence intervals for each physiological parameter per species ") %>%
  kable_styling(font_size = 10, full_width = F) %>% 
  pack_rows("(a) SSID", 1, 8) %>%
  pack_rows("(b) PSTR", 9, 16) %>%
  pack_rows("(c) PAST", 17, 24)
table6
```


```{r excel WB, message=FALSE, warning=FALSE}
### Create workbook
wb <- createWorkbook()
# add 'Table 1' worksheet
addWorksheet(wb, "Table 1 - protein") 
writeData(wb, sheet = 1, x = pro_tab)
setColWidths(wb, sheet = 1, cols = 1:5, widths = "auto")
# add 'Table 2' worksheet
addWorksheet(wb, "Table 2 - lipid") 
writeData(wb, sheet = 2, x = lipid_tab)
setColWidths(wb, sheet = 2, cols = 1:5, widths = "auto")
# add 'Table 3' worksheet
addWorksheet(wb, "Table 3 - carbohydrate") 
writeData(wb, sheet = 3, x = carb_tab)
setColWidths(wb, sheet = 3, cols = 1:5, widths = "auto")
# add 'Table 4' worksheet
addWorksheet(wb, "Table 4 - density") 
writeData(wb, sheet = 4, x = den_tab)
setColWidths(wb, sheet = 4, cols = 1:5, widths = "auto")
# add 'Table 5' worksheet
addWorksheet(wb, "Table 5 - chlorophyll") 
writeData(wb, sheet = 5, x = chla_tab)
setColWidths(wb, sheet = 5, cols = 1:5, widths = "auto")
# add 'Table 6' worksheet
addWorksheet(wb, "Table 6 - total host") 
writeData(wb, sheet = 6, x = host_tab)
setColWidths(wb, sheet = 6, cols = 1:5, widths = "auto")
# save workbook
saveWorkbook(wb, file="Data/Supplemental/Supplemental_Tables.xlsx", overwrite = TRUE)
```



<br/>


## Session information

Session information from the last run date on `r date`:

```{r}
sessionInfo()
```

