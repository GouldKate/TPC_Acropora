---
title: "Acropora_DataCleaning_Ecophys"
author: "Gould, Katelyn"
date: "10/2/2019"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  html_document:
    toc: true
    toc_float: true
    df_print: kable 
    code_folding: hide
editor_options: 
  chunk_output_type: console
---

#Description
In this file I combine all the ecophysiological data (zooxanthella densities, chlorophyll a concentration, surface area, growth rate, and protein content extracted from Acropora cervicornis corals that were flash frozen in liquid nitrogen on April 24th 2017. Corals were then processed in the lab at the University of North Carolina at Chapel Hill in June-August 2019. 
</br></br>
## What is in this file?
Data cleaning for further analyses using `tidyverse` (and a few other) packages
</br></br>


```{rsetup, results='hide', message=FALSE}
knitr::opts_chunk$set(echo = TRUE) # will automatically include code in the ouput unless we state otherwise
knitr::opts_chunk$set(warning= FALSE) # will NOT include warning messages in the output unless we state otherwise
# knitr::opts_chunk$set(tidy.opts=list(width.cutoff=60),tidy=TRUE) #keeps code wrapped in the output

# if you haven't installed these packages run the following line (first delete the # sign):
install.packages(c("tidyverse", "janitor", "kableExtra", "cowplot", "skimr", "measurements"))

library(tidyverse) #data wrangling & cleaning incl. ggplot
library(janitor) # more data cleaning functions
library(kableExtra) # making pretty tables
library(cowplot) # making publication quality figures or multi-panel figures
library(skimr) # tool to get quick overview of dataset
library(measurements) # useful to convert units
library(readr)
library(dplyr)
library(esquisse)
library(rvg)
library(ggplot2)
library(plyr)

```
</br></br>

# Data
For this common garden experiment, we will upload ecophys data extrapolated from frozen Acropora cervicornis corals in June-August 2019. 
This experiment is esimating the differences between three treatments and a control aquarium for the various ecophys factors:
* Metabolic rates "Fitness" (Gross Photosynthesis, Respiration) umol/cm2/hr _See: Data_Manipultion_final.csv, and TPCs_ALL_acropora_final.csv_
* Growth rates are in _% larger than the intial value.
* Protein Concentration ug/cm2 (coral tissue)
* Zooxanthella densities Zoox/coral, cm2, log(Zoox/cm2), & Zoox/protein
* Chlorophylla a concentration Chl/zoox (pg), Chl/protein, ug/cm2, log(ug/cm2)
</br></br>
Some important notes:  
* Surface area in cm^2 was estimated via 3D scans
* Growth rates were estimated via buoyant weights taken before and after the experimental temperature ramping and is in %
* Protein, chlorophyll a, and zooxanthella density are all standardized to Surface area. 
* Coral ID's represent the Genotypes: K2, M5 & M6 followed by treatment 01 (Sprinkler), 02 (Lights), 03 (lights & sprinkler), & C (control).

</br></br>

__Read in Reef Check Substrate Data__
```{r data_import}

setwd("C:/Github/TPC_Acropora/Raw_data")
getwd()

data<-read.csv("C:/Github/TPC_Acropora/Raw_data/Ecophys_data/TidyEcopphysData.csv")
```
</br></br>

```{r data_review}
# review variables and class types
str(data)

# use the janitor package to clean up column names- lowercase, no spaces
data <- janitor::clean_names(data)

# We can do some manual investigation of the data:
  # How many unqiue coral reefs are included in this dataset?
length(unique(data$genotype)) #4
length(unique(data$coral_id)) #52
# What are the different substrate codes?
unique(data$treatment) # 1,2,3,c,i


# Use the kableExtra package to view a pretty table for a subset of the data:
  # First, let's just subset the first 10 rows
RawDataTab<-data%>% 
    # Add a title
  kableExtra::kable(caption="Raw Ecophys") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F) 


```

```{r skimr, results='hide'}

# And we can use the skimr package to review the dataset
skimr::skim(data)

```

#Raw Data Plots Treatments {.tabset}

##Protein
```{r plot raw data protein concentration um/cm2}

raw1<-ggplot(data, aes(x=treatment, y=protein_ug_ml, group = treatment, col = genotype))+
  geom_boxplot( colour= "grey50")+
  geom_jitter()#

raw1+ scale_y_continuous(name = "Mean Protein (ug/ml)")
  
#raw data protein concentration, standardized to coral SA ug/cm2}

raw2<-ggplot(data, aes(x=treatment, y=protein_3d_ug_cm2, group = treatment, col = genotype))+
  geom_boxplot( colour= "grey50")+
  geom_jitter()#

raw2+ scale_y_continuous(name = "Mean Protein (ug/cm^2)")
raw2

raw2log<-ggplot(data, aes(x=treatment, y=log(protein_3d_ug_cm2), group = treatment, col = genotype))+
  geom_boxplot( colour= "grey50")+
  geom_jitter()#

raw2log+ scale_y_continuous(name = "Mean Protein log(ug/cm^2)")
raw2log
```

##Zooxanthella densities 
```{r plot raw data of zooxanthella densities}

#zoox/coral	
rawz1<-ggplot(data, aes(x=treatment, y=zoox_coral, group = treatment, col = genotype))+
  geom_boxplot( colour= "grey50")+
  geom_jitter()#

rawz1+ scale_y_continuous(name = "Zoox/coral")
rawz1

#zoox/cm2 3D
rawz2<-ggplot(data, aes(x=treatment, y=zoox_cm2_3d, group = treatment, col = genotype))+
  geom_boxplot( colour= "grey50")+
  geom_jitter()#

rawz2+ scale_y_continuous(name = "Zoox/cm2")

rawz2
#zoox/cm2log10

rawz3<-ggplot(data, aes(x=treatment, y=zoox_cm2log10, group = treatment, col = genotype))+
  geom_boxplot( colour= "grey50")+
  geom_jitter()#

rawz3+ scale_y_continuous(name = "log(Zoox/cm2)")

rawz3
#	zoox/protein

rawz4<-ggplot(data, aes(x=treatment, y=zoox_protein, group = treatment, col = genotype))+
  geom_boxplot( colour= "grey50")+
  geom_jitter()#

rawz4+ scale_y_continuous(name = "Zoox/protein")

rawz4
```

## Chlorophyl a Concentration

```{r}
#C value ug ml	
rawc<-ggplot(data, aes(x=treatment, y=c_value_ug_ml, group = treatment, col = genotype))+
  geom_boxplot( colour= "grey50")+
  geom_jitter()#

rawc+ scale_y_continuous(name = "C Value (ug/ml)")

rawzc

#Chl (ug)	logged
rawc2<-ggplot(data, aes(x=treatment, y=log(chl_ug), group = treatment, col = genotype))+
  geom_boxplot( colour= "grey50")+
  geom_jitter()#

rawc2+ scale_y_continuous(name = "Chlorophyl a (ug)")

rawzc2
#Chl/zoox (pg) logged

rawc3<-ggplot(data, aes(x=treatment, y=log(chl_zoox_pg), group = treatment, col = genotype))+
  geom_boxplot( colour= "grey50")+
  geom_jitter()#

rawc3+ scale_y_continuous(name = "Chlorophyll a/zoox (picograms)")

rawzc3
#Chl/protein
rawc4<-ggplot(data, aes(x=treatment, y=log(chl_protein), group = treatment, col = genotype))+
  geom_boxplot( colour= "grey50")+
  geom_jitter()#

rawc4+ scale_y_continuous(name = "Chlorophyll a/protein ")

rawzc4

#Chl ug/cm2 log10

rawc5<-ggplot(data, aes(x=treatment, y=chl_ug_cm2_log10, group = treatment, col = genotype))+
  geom_boxplot( colour= "grey50")+
  geom_jitter()#

rawc5+ scale_y_continuous(name = "Log (Chlorophyll a (ug/cm2)) ")

rawzc5

```
##Growth rate

```{r}
#Growth Rate

rawg<-ggplot(data, aes(x=treatment, y=growth_rate, group = treatment, col = genotype))+
  geom_boxplot( colour= "grey50")+
  geom_jitter()#

rawg+ scale_y_continuous(name = "Growth Rate")

rawg
```

##Raw Data Plots Genotype {.tabset}

##Protein
```{r plot raw data protein concentration um/cm2}

ra1<-ggplot(data, aes(x=genotype, y=protein_ug_ml, group = genotype, col = treatment))+
  geom_boxplot( colour= "grey50")+
  geom_jitter()#

ra1+ scale_y_continuous(name = "Mean Protein (ug/ml)")
  
ra1
# data protein concentration, standardized to coral SA ug/cm2}

ra2<-ggplot(data, aes(x=genotype, y=protein_3d_ug_cm2, group = genotype, col = treatment))+
  geom_boxplot( colour= "grey50")+
  geom_jitter()#

ra2+ scale_y_continuous(name = "Mean Protein (ug/cm^2)")
ra2

ra2log<-ggplot(data, aes(x=genotype, y=log(protein_3d_ug_cm2), group = genotype, col = treatment))+
  geom_boxplot( colour= "grey50")+
  geom_jitter()#

ra2log+ scale_y_continuous(name = "Mean Protein log(ug/cm^2)")
ra2log
```

##Zooxanthella densities 
```{r plot raw data of zooxanthella densities}

#zoox/coral	
raz1<-ggplot(data, aes(x=genotype, y=zoox_coral, group = genotype, col = treatment))+
  geom_boxplot( colour= "grey50")+
  geom_jitter()#

raz1+ scale_y_continuous(name = "Zoox/coral")
raz1

#zoox/cm2 3D
raz2<-ggplot(data, aes(x=genotype, y=zoox_cm2_3d, group = genotype, col = treatment))+
  geom_boxplot( colour= "grey50")+
  geom_jitter()#

raz2+ scale_y_continuous(name = "Zoox/cm2")

raz2
#zoox/cm2log10

raz3<-ggplot(data, aes(x=genotype, y=zoox_cm2log10, group = genotype, col = treatment))+
  geom_boxplot( colour= "grey50")+
  geom_jitter()#

raz3+ scale_y_continuous(name = "log(Zoox/cm2)")

raz3
#	zoox/protein

raz4<-ggplot(data, aes(x=genotype, y=zoox_protein, group = genotype, col = treatment))+
  geom_boxplot( colour= "grey50")+
  geom_jitter()#

raz4+ scale_y_continuous(name = "Zoox/protein")

raz4
```

## Chlorophyl a Concentration

```{r}
#C value ug ml	
rac<-ggplot(data, aes(x=genotype, y=c_value_ug_ml, group = genotype, col = treatment))+
  geom_boxplot( colour= "grey50")+
  geom_jitter()#

rac+ scale_y_continuous(name = "C Value (ug/ml)")

razc

#Chl (ug)	logged
rac2<-ggplot(data, aes(x=genotype, y=log(chl_ug), group = genotype, col = treatment))+
  geom_boxplot( colour= "grey50")+
  geom_jitter()#

rac2+ scale_y_continuous(name = "Chlorophyl a (ug)")

razc2
#Chl/zoox (pg) logged

rac3<-ggplot(data, aes(x=genotype, y=log(chl_zoox_pg), group = genotype, col = treatment))+
  geom_boxplot( colour= "grey50")+
  geom_jitter()#

rac3+ scale_y_continuous(name = "Chlorophyll a/zoox (picograms)")

razc3
#Chl/protein
rac4<-ggplot(data, aes(x=genotype, y=log(chl_protein), group = genotype, col = treatment))+
  geom_boxplot( colour= "grey50")+
  geom_jitter()#

rac4+ scale_y_continuous(name = "Chlorophyll a/protein ")

razc4

#Chl ug/cm2 log10

rac5<-ggplot(data, aes(x=genotype, y=chl_ug_cm2_log10, group = genotype, col = treatment))+
  geom_boxplot( colour= "grey50")+
  geom_jitter()#

rac5+ scale_y_continuous(name = "Log (Chlorophyll a (ug/cm2)) ")

razc5

```

##Growth rate

```{r}
#Growth Rate

rag<-ggplot(data, aes(x=genotype, y=growth_rate, group = genotype, col = treatment))+
  geom_boxplot( colour= "grey50")+
  geom_jitter()#

rag+ scale_y_continuous(name = "Growth Rate")

rag
```


```{r tidying}


#make a subset of data 
# use filter to pick specific rows (or types of rows) you want to keep


 data_T1<-subset(data, treatment =="1")
 data_T2<-subset(data, treatment =="2")        
 data_T3<-subset(data, treatment =="3")
 data_Tc<-subset(data, treatment =="c")
 data_Ti<-subset(data, treatment =="i")
 
 #rm extra coral from T3 (M7)

# use mutate to create a new column - mean & Std dev of 
data_T1<- data_T1 %>% 
  select(coral_id, genotype, treatment) %>%
  mutate(sum_points = sum(total))
```

# Variable Means and SE
```{r Means for treatments & genotypes}
AllMeans <- ddply(data, c('treatment', 'genotype'), summarise,
                   #protein
                   Protein.mean= mean(protein_3d_ug_cm2, na.rm=T), #mean 
                   N = sum(!is.na(protein_3d_ug_cm2)),
                   Protein.se = sd(protein_3d_ug_cm2, na.rm=T)/sqrt(N), #SE
                   #chlorophyll a
                   Chlorophyll.mean= mean(chl_ug_cm2, na.rm=T), #mean 
                   Chlorophyll.se = sd(chl_ug_cm2, na.rm=T)/sqrt(N), #SE
                   #zooxanthella
                   Zooxs.mean  = mean(zoox_cm2_3d, na.rm=T),
                   Zooxs.se = sd(zoox_cm2_3d, na.rm=T)/sqrt(N),
                   #Surface Area
                   SA.mean = mean(sa_cm2, na.rm=T),
                   SA.se = sd(sa_cm2, na.rm=T)/sqrt(N),
                   growth.mean  = mean(growth_rate),
                   Growth.se = sd(growth_rate, na.rm=T)/sqrt(N))



meanplor<-ggplot(AllMeans, aes(x=genotype, y=Protein.mean, color=treatment))+
  geom_point()+
  facet_wrap(~treatment)


                   

```

